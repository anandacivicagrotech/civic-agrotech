<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FarmLab - ‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏ü‡∏≤‡∏£‡πå‡∏°</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #43cea2 0%, #185a9d 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 25px 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        h1 {
            color: #333;
            font-size: 2rem;
            margin: 0;
        }

        .subtitle {
            color: #666;
            font-size: 0.95rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            background: #f5f5f5;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #666;
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }

        .tab-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            align-items: center;
            width: 100%;
        }

        .tab-nav-left {
            display: flex;
            gap: 10px;
            flex: 1;
            flex-wrap: nowrap;
        }

        .tab-nav-right {
            display: flex;
            gap: 10px;
            flex-shrink: 0;
        }

        .tab-button {
            padding: 12px 20px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.3s;
            color: #666;
            text-align: center;
            white-space: nowrap;
        }

        /* Responsive ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏•‡πá‡∏Å */
        @media (max-width: 1024px) {
            .tab-nav {
                flex-wrap: wrap;
            }
            .tab-nav-left {
                flex-wrap: wrap;
            }
        }

        .tab-button:hover {
            border-color: #43cea2;
            color: #43cea2;
        }

        .tab-button.active {
            background: #43cea2;
            color: white;
            border-color: #43cea2;
        }

        /* Sub-navigation */
        .sub-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }

        .sub-nav-button {
            padding: 10px 20px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
        }

        .sub-nav-button:hover {
            color: #43cea2;
            border-bottom-color: #43cea2;
        }

        .sub-nav-button.active {
            color: #43cea2;
            border-bottom-color: #43cea2;
        }

        .sub-nav-button:disabled {
            color: #ccc;
            cursor: not-allowed;
        }

        .sub-tab-content {
            display: none;
        }

        .sub-tab-content.active {
            display: block;
        }

        .device-tab-content {
            display: none;
        }

        .device-tab-content.active {
            display: block;
        }

        /* Table row hover */
        table tbody tr:hover {
            background: #f8f9fa;
        }

        /* Clickable table row */
        table tbody tr[onclick] {
            cursor: pointer;
            transition: background 0.2s;
        }

        table tbody tr[onclick]:hover {
            background: #e3f2fd !important;
        }

        /* Gallery */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .gallery-item {
            transition: transform 0.3s;
        }

        .gallery-item:hover {
            transform: translateY(-5px);
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex !important;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
        }

        .form-group input[type="checkbox"] {
            margin-right: 5px;
        }

        /* Tags */
        .tag {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            margin: 3px;
            background: #43cea2;
            color: white;
            border-radius: 5px;
            font-size: 0.9rem;
        }

        .tag button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0;
            line-height: 1;
        }

        .tag button:hover {
            color: #ff4444;
        }

        .tab-content {
            display: none;
            width: 100%;
            clear: both;
        }

        .tab-content.active {
            display: block;
        }

        .settings-dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            z-index: 1000;
            min-width: 180px;
            margin-top: 5px;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-menu button {
            display: block;
            width: 100%;
            padding: 12px 20px;
            border: none;
            background: none;
            text-align: left;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
        }

        .dropdown-menu button:hover {
            background: #f8f9fa;
            color: #43cea2;
        }

        .dropdown-menu button:first-child {
            border-radius: 8px 8px 0 0;
        }

        .dropdown-menu button:last-child {
            border-radius: 0 0 8px 8px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .card h2 {
            color: #333;
            font-size: 1.3rem;
            margin-bottom: 20px;
        }

        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .project-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .project-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .project-card h3 {
            color: #43cea2;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .project-meta {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            font-size: 0.9em;
            color: #666;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge.green {
            background: #d4edda;
            color: #155724;
        }

        .badge.active {
            background: #d4edda;
            color: #155724;
        }

        .btn {
            padding: 12px 30px;
            background: #43cea2;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #3ab890;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(67, 206, 162, 0.3);
        }

        .btn-secondary {
            padding: 12px 24px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .back-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 20px;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-block;
        }

        .back-btn:hover {
            background: #5a6268;
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            color: #555;
            font-size: 0.9rem;
            font-weight: 600;
        }

        input, select, textarea {
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.95rem;
            outline: none;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            border-color: #43cea2;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .image-upload {
            border: 2px dashed #e0e0e0;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .image-upload:hover {
            border-color: #43cea2;
            background: #f8fff8;
        }

        .image-upload input {
            display: none;
        }

        .image-preview {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .image-preview img {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .chart-container h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .template-fields {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .field-item {
            background: white;
            padding: 10px 15px;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .view-container {
            display: none;
        }

        .view-container.active {
            display: block;
        }

        .sensor-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #43cea2;
            margin: 10px 0;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }

        @media (max-width: 1024px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            .chart-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }

            .projects-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-left">
                <h1>üå± FarmLab</h1>
                <span class="subtitle">‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏õ‡∏ü‡∏≤‡∏£‡πå‡∏°</span>
            </div>
            <div class="header-right">
                <div class="user-info">
                    <span>üë§ ‡∏î‡∏£.‡∏™‡∏°‡∏ä‡∏≤‡∏¢</span>
                </div>
            </div>
        </header>

        <div class="tab-nav">
            <div class="tab-nav-left">
                <button class="tab-button active" onclick="showTab('dashboard')">üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° (Dashboard)</button>
                <button class="tab-button" onclick="showTab('projects')">üìÅ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (Projects)</button>
                <button class="tab-button" onclick="showTab('data')">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Data Entry)</button>
                <button class="tab-button" onclick="showTab('greenhouses')">üè† ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô (Greenhouses)</button>
            </div>
        </div>

        <!-- Tab 1: Dashboard -->
        <div id="dashboard" class="tab-content active">
            <div class="card">
                <h2>üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° (Dashboard)</h2>
                <p style="color: #888; padding: 20px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÉ‡∏ô Phase 5...</p>
            </div>
        </div>

        <!-- Tab 2: Projects -->
        <div id="projects" class="tab-content">
            <div id="projectsListView" class="view-container active">
                <div class="card">
                    <h2>üìÅ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (Project Management)</h2>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; margin-top: 20px;">
                        <h3 style="margin: 0;">‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                        <button class="btn" onclick="showCreateProject()">+ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</button>
                    </div>
                    <div class="projects-grid" id="projectsGrid"></div>
                </div>
            </div>

            <!-- Create Project View -->
            <div id="createProjectView" class="view-container">
                <div class="card">
                    <button class="back-btn" onclick="showProjectsList()">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
                    <h2>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</h2>
                    <form id="projectForm" onsubmit="createProject(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</label>
                                <input type="text" id="projectName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ú‡∏±‡∏Å‡∏Å‡∏≤‡∏î‡∏´‡∏≠‡∏°" required>
                            </div>
                            <div class="form-group">
                                <label>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö (‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏à‡∏±‡∏¢)</label>
                                <input type="text" id="projectOwner" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏à‡∏±‡∏¢" required>
                            </div>
                            <div class="form-group">
                                <label>‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô *</label>
                                <select id="projectGreenhouse" onchange="updateProjectZones()" required>
                                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Zone *</label>
                                <select id="projectZone" onchange="updateProjectLayers()" required>
                                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Zone --</option>
                                </select>
                            </div>
                            <div class="form-group full-width">
                                <label>Layers *</label>
                                <div id="projectLayers" style="display: flex; gap: 10px; flex-wrap: wrap; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; min-height: 50px;">
                                    <p style="color: #888; margin: 0;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡∏∞ Zone ‡∏Å‡πà‡∏≠‡∏ô</p>
                                </div>
                            </div>
                            <div class="form-group full-width" id="iotConnectionInfo" style="display: none;">
                                <label>üîó ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</label>
                                <div style="padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #43cea2;">
                                    <div style="font-weight: 600; margin-bottom: 10px;">‚úÖ ‡∏à‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠:</div>
                                    <div id="iotDevicesList"></div>
                                </div>
                            </div>
                            <div class="form-group full-width" id="environmentDataInfo" style="display: none;">
                                <label style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox" id="useEnvironmentData" checked onchange="toggleEnvironmentData()">
                                    <span>üìä ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Environment ‡∏à‡∏≤‡∏Å Controller</span>
                                </label>
                                <div id="environmentDataPreview" style="padding: 15px; background: #f0f8ff; border-radius: 8px; border-left: 4px solid #185a9d; margin-top: 10px;">
                                    <div style="font-weight: 600; margin-bottom: 10px;">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥:</div>
                                    <div id="environmentSensorsList"></div>
                                    
                                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;">
                                        <div style="font-weight: 600; margin-bottom: 10px;">üìç ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:</div>
                                        <div style="margin-left: 20px;">
                                            <label style="display: block; margin-bottom: 8px; cursor: pointer;">
                                                <input type="radio" name="dataSource" value="room" checked onchange="updateDataSourcePreview()">
                                                <strong>‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡πâ‡∏≠‡∏á</strong> - ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Ç‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô
                                            </label>
                                            <label style="display: block; cursor: pointer;">
                                                <input type="radio" name="dataSource" value="layer" onchange="updateDataSourcePreview()">
                                                <strong>‡∏Ñ‡πà‡∏≤‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏° Layer</strong> - ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞ Layer
                                            </label>
                                        </div>
                                        <div id="dataSourcePreview" style="margin-top: 10px; padding: 10px; background: #fff; border-radius: 6px; font-size: 0.9em; color: #666;">
                                            ‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å: <strong>room</strong> (‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡πâ‡∏≠‡∏á)
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group full-width">
                                <label>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</label>
                                <textarea id="projectDesc" placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏•‡∏≠‡∏á"></textarea>
                            </div>
                            <div class="form-group full-width">
                                <label>‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö</label>
                                <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                                    <input type="text" id="newFieldName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ü‡∏¥‡∏•‡∏î‡πå ‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á" style="flex: 1;">
                                    <input type="text" id="newFieldUnit" placeholder="‡∏´‡∏ô‡πà‡∏ß‡∏¢ ‡πÄ‡∏ä‡πà‡∏ô cm" style="width: 150px;">
                                    <button type="button" class="btn" onclick="addDataField()" style="padding: 10px 20px;">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                                </div>
                                <div class="template-fields" id="dataFieldsList">
                                    <div class="field-item">
                                        ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á (cm)
                                        <button type="button" onclick="removeDataField(this)" style="background: none; border: none; color: #ff4444; cursor: pointer; margin-left: 10px;">√ó</button>
                                    </div>
                                    <div class="field-item">
                                        ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÉ‡∏ö (‡πÉ‡∏ö)
                                        <button type="button" onclick="removeDataField(this)" style="background: none; border: none; color: #ff4444; cursor: pointer; margin-left: 10px;">√ó</button>
                                    </div>
                                    <div class="field-item">
                                        ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (g)
                                        <button type="button" onclick="removeDataField(this)" style="background: none; border: none; color: #ff4444; cursor: pointer; margin-left: 10px;">√ó</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div style="margin-top: 30px; display: flex; gap: 15px;">
                            <button type="submit" class="btn">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</button>
                            <button type="button" class="btn btn-secondary" onclick="showProjectsList()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Project Detail View -->
            <div id="projectDetailView" class="view-container">
                <div class="card">
                    <button class="back-btn" onclick="showProjectsList()">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
                    <div id="projectDetailContent"></div>
                </div>
            </div>
        </div>

        <!-- Tab 3: Data Entry -->
        <div id="data" class="tab-content">
            <div class="card">
                <h2>üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Data Entry)</h2>
                <p style="color: #666; margin-bottom: 20px;">
                    <strong>‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ:</strong> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Crop ‚Üí ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏° template ‚Üí ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ ‚Üí ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) ‚Üí Save<br>
                    <strong>‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:</strong> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡πá‡∏ß ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠ OneDrive ‡∏ä‡πâ‡∏≤ ‡πÜ ‡∏°‡∏µ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ (3-5 ‡∏£‡∏π‡∏õ) ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö AI
                </p>
                <form id="dataForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</label>
                            <select id="dataProject" onchange="updateDataRounds()" required>
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>‡∏£‡∏≠‡∏ö</label>
                            <select id="dataRound" required>
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏ö</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</label>
                            <input type="date" id="dataDate" required>
                        </div>
                        <div class="form-group">
                            <label>‡∏£‡∏∞‡∏¢‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï</label>
                            <select id="dataStage" required>
                                <option value="germination">‡πÄ‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏•‡πá‡∏î</option>
                                <option value="seedling">‡∏ï‡πâ‡∏ô‡∏Å‡∏•‡πâ‡∏≤</option>
                                <option value="vegetative">‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï</option>
                                <option value="mature">‡πÇ‡∏ï‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà</option>
                                <option value="harvest">‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß</option>
                            </select>
                        </div>

                        <!-- Template Fields -->
                        <div class="form-group full-width" style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                            <h3 style="margin-bottom: 15px;">üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏° Template</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á (cm)</label>
                                    <input type="number" step="0.1" id="dataHeight" placeholder="‡πÄ‡∏ä‡πà‡∏ô 15.5">
                                </div>
                                <div class="form-group">
                                    <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÉ‡∏ö</label>
                                    <input type="number" id="dataLeafCount" placeholder="‡πÄ‡∏ä‡πà‡∏ô 8">
                                </div>
                                <div class="form-group">
                                    <label>‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏ö (cm)</label>
                                    <input type="number" step="0.1" id="dataLeafSize" placeholder="‡πÄ‡∏ä‡πà‡∏ô 5.2">
                                </div>
                                <div class="form-group">
                                    <label>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (g)</label>
                                    <input type="number" step="0.1" id="dataWeight" placeholder="‡πÄ‡∏ä‡πà‡∏ô 185.5">
                                </div>
                            </div>
                        </div>

                        <div class="form-group full-width">
                            <label>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (2-5 ‡∏£‡∏π‡∏õ)</label>
                            <div class="image-upload" onclick="document.getElementById('dataImages').click()">
                                <input type="file" id="dataImages" accept="image/*" multiple onchange="previewDataImages(event)">
                                <p>üì∑ ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</p>
                                <p style="font-size: 0.85rem; color: #999; margin-top: 10px;">‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÑ‡∏î‡πâ</p>
                            </div>
                            <div class="image-preview" id="dataImagePreview"></div>
                        </div>

                        <div class="form-group full-width">
                            <label>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏û‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏©)</label>
                            <textarea id="dataNotes" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏û‡∏ö‡πÉ‡∏ö‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á rack 3, ‡πÉ‡∏ö‡πÑ‡∏´‡∏°‡πâ, ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏≠‡∏∑‡πà‡∏ô ‡πÜ"></textarea>
                        </div>
                    </div>
                    <div style="margin-top: 30px; display: flex; gap: 15px;">
                        <button type="submit" class="btn">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                        <button type="reset" class="btn btn-secondary">üîÑ ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Tab 4: Greenhouses -->
        <div id="greenhouses" class="tab-content">
            <!-- Sub-navigation -->
            <div class="sub-nav">
                <button class="sub-nav-button active" onclick="showGreenhousesSubTab('greenhousesList')">üè† ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô</button>
                <button class="sub-nav-button" onclick="showGreenhousesSubTab('devicesList')">üéõÔ∏è ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</button>
            </div>

            <!-- Sub-tab 1: ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô -->
            <div id="greenhousesList" class="sub-tab-content active">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>üè† ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô</h2>
                        <button class="btn" onclick="showGreenhouseForm()">+ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà</button>
                    </div>
                    <div class="projects-grid" id="greenhousesGrid"></div>
                </div>
            </div>

            <!-- Sub-tab 2: ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (Phase 2B) -->
            <div id="devicesList" class="sub-tab-content">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>üéõÔ∏è ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
                        <button class="btn" onclick="showAddDeviceForm()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</button>
                    </div>
                    <div id="devicesGrid"></div>
                </div>
            </div>
        </div>

        <!-- Tab 6: Sensors (‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß) -->
        <div id="sensors" class="tab-content">
            <div class="card">
                <h2>üìä Dashboard - ‡πÄ‡∏ã‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå IoT</h2>
                <p style="color: #666; margin-bottom: 20px;">
                    <strong>‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£:</strong> ‡πÄ‡∏ã‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• pH, EC, ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ ‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡∏ä‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß<br>
                    <strong>‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:</strong> ‡∏î‡∏π‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏£‡∏≤‡∏ü ‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏ó‡∏≥ AI ‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏õ‡∏î‡∏π‡∏´‡∏•‡∏≤‡∏¢‡∏ó‡∏µ‡πà
                </p>
            </div>

            <!-- Greenhouse Selection Cards -->
            <div class="card">
                <h3 style="margin-bottom: 15px;">üè† ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô</h3>
                <div class="projects-grid" id="greenhouseCards">
                    <div class="project-card" onclick="selectGreenhouse('no1')" id="card-no1">
                        <h3>üè† No.1</h3>
                        <p style="color: #666; margin: 10px 0;">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏Å - ‡∏ú‡∏±‡∏Å‡∏™‡∏•‡∏±‡∏î</p>
                        <div class="project-meta">
                            <span class="badge green">‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</span>
                        </div>
                    </div>
                    <div class="project-card" onclick="selectGreenhouse('laba')" id="card-laba">
                        <h3>üî¨ Lab A</h3>
                        <p style="color: #666; margin: 10px 0;">Lab ‡∏ó‡∏î‡∏•‡∏≠‡∏á - ‡∏ú‡∏±‡∏Å‡∏Å‡∏≤‡∏î‡∏´‡∏≠‡∏°</p>
                        <div class="project-meta">
                            <span class="badge green">‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</span>
                        </div>
                    </div>
                    <div class="project-card" onclick="selectGreenhouse('blue')" id="card-blue">
                        <h3>üîµ Blue Room</h3>
                        <p style="color: #666; margin: 10px 0;">‡∏´‡πâ‡∏≠‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ - R&D</p>
                        <div class="project-meta">
                            <span class="badge green">‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Data Display Section -->
            <div id="greenhouseData" style="display: none;">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 id="selectedGreenhouseName" style="margin: 0;">üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô No.1</h3>
                        <button class="btn btn-secondary" onclick="clearSelection()">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô</button>
                    </div>
                </div>

                <!-- Real-time Stats -->
                <div class="sensor-stats">
                <div class="stat-card">
                    <div class="stat-label">pH</div>
                    <div class="stat-value">6.2</div>
                    <div class="stat-label">‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: 5 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">EC (mS/cm)</div>
                    <div class="stat-value">2.1</div>
                    <div class="stat-label">‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: 5 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (¬∞C)</div>
                    <div class="stat-value">26.5</div>
                    <div class="stat-label">‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: 5 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">PPFD (¬µmol/m¬≤/s)</div>
                    <div class="stat-value">250</div>
                    <div class="stat-label">‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: 5 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</div>
                </div>
            </div>

                <!-- Charts -->
                <div class="chart-grid">
                    <div class="chart-container">
                        <h3>üìà pH - 7 ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤</h3>
                        <canvas id="phChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>üìà EC - 7 ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤</h3>
                        <canvas id="ecChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>üìà ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ - 7 ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤</h3>
                        <canvas id="tempChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>üìà PPFD - 7 ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤</h3>
                        <canvas id="ppfdChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // Templates data
        const templates = {
            lettuce: {
                name: '‡∏ú‡∏±‡∏Å‡∏Å‡∏≤‡∏î‡∏´‡∏≠‡∏°',
                fields: ['‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏ï‡πâ‡∏ô (cm)', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡πÉ‡∏ö (cm)', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÉ‡∏ö (cm)', '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÉ‡∏ö', '‡∏ó‡∏£‡∏á‡∏û‡∏∏‡πà‡∏° (cm)', '‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏£‡∏≤‡∏Å (g)', '‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥']
            },
            leafy: {
                name: '‡∏ú‡∏±‡∏Å‡πÉ‡∏ö',
                fields: ['‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á (cm)', '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÉ‡∏ö', '‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏ö (cm)', '‡∏™‡∏µ‡πÉ‡∏ö', '‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (g)']
            }
        };

        // Greenhouses data
        let greenhouses = JSON.parse(localStorage.getItem('farmlab_greenhouses')) || [];

        // Force reload sample data (set to true to reset)
        const FORCE_RELOAD = true;

        // Initialize sample data if empty or force reload
        if (greenhouses.length === 0 || FORCE_RELOAD) {
            greenhouses = [
                {
                    id: 1,
                    name: "No.1",
                    size: "100",
                    zones: ["A", "B", "C"],
                    layers: ["1", "2", "3", "4", "5"],
                    controllers: [
                        {
                            id: "GEN3-001",
                            name: "Smart Grow Controller Gen3 #1",
                            zone: null,
                            status: "online",
                            // Device ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞ room level
                            data: {
                                room: {
                                    temperature: 25,
                                    humidity: 65,
                                    ppfd: 250,
                                    co2: 850,
                                    ec: 2.1,
                                    ph: 6.2
                                }
                            },
                            // ‡πÄ‡∏ã‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á)
                            sensors: ["temperature", "humidity", "ppfd", "co2", "ec", "ph"]
                        }
                    ],
                    cameras: [
                        {
                            id: "CAM-001",
                            name: "Camera Zone A",
                            zone: "Zone A",
                            layers: ["1", "2", "3"],
                            status: "online",
                            lastCapture: "2025-11-10T10:00:00"
                        },
                        {
                            id: "CAM-002",
                            name: "Camera Zone B",
                            zone: "Zone B",
                            layers: ["4", "5"],
                            status: "online",
                            lastCapture: "2025-11-10T10:15:00"
                        }
                    ],
                    projects: ["‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏û‡∏∑‡∏ä‡∏ú‡∏±‡∏Å‡πÉ‡∏ö 2 ‡∏ä‡∏ô‡∏¥‡∏î (‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏≠‡πã, ‡πÄ‡∏Ñ‡∏•)"]
                },
                {
                    id: 2,
                    name: "Lab A",
                    size: "80",
                    zones: ["A", "B"],
                    layers: ["1", "2", "3"],
                    controllers: [
                        {
                            id: "GEN3-002",
                            name: "Smart Grow Controller Gen3 #2",
                            zone: null,
                            status: "online",
                            // Lab A ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞ room level
                            data: {
                                room: {
                                    temperature: 24,
                                    humidity: 70,
                                    ppfd: 280,
                                    co2: 900,
                                    ec: 1.8,
                                    ph: 5.9
                                }
                            },
                            sensors: ["temperature", "humidity", "ppfd", "co2", "ec", "ph"]
                        }
                    ],
                    cameras: [
                        {
                            id: "CAM-003",
                            name: "Camera Zone A",
                            zone: "Zone A",
                            layers: ["1", "2"],
                            status: "online",
                            lastCapture: "2025-11-10T11:00:00"
                        },
                        {
                            id: "CAM-004",
                            name: "Camera Zone B",
                            zone: "Zone B",
                            layers: ["3"],
                            status: "online",
                            lastCapture: "2025-11-10T11:10:00"
                        }
                    ],
                    projects: ["‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏û‡∏∑‡∏ä‡∏ú‡∏±‡∏Å‡πÉ‡∏ö 4 ‡∏ä‡∏ô‡∏¥‡∏î (‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏≠‡πã, ‡πÄ‡∏Ñ‡∏•, Sorrel, Frillice)"]
                },
                {
                    id: 3,
                    name: "Blue Room",
                    size: "60",
                    zones: ["A"],
                    layers: ["1", "2", "3", "4"],
                    controllers: [
                        {
                            id: "GEN3-003",
                            name: "Smart Grow Controller Gen3 #3",
                            zone: null,
                            status: "online",
                            data: {
                                room: {
                                    temperature: 22,
                                    humidity: 60,
                                    ppfd: 220,
                                    co2: 800,
                                    ec: 1.5,
                                    ph: 6.0
                                }
                            },
                            sensors: ["temperature", "humidity", "ppfd", "co2", "ec", "ph"]
                        }
                    ],
                    cameras: [
                        {
                            id: "CAM-005",
                            name: "Camera Layer 1",
                            zone: "Zone A",
                            layers: ["1"],
                            status: "online",
                            lastCapture: "2025-11-10T12:00:00"
                        },
                        {
                            id: "CAM-006",
                            name: "Camera Layer 2",
                            zone: "Zone A",
                            layers: ["2"],
                            status: "online",
                            lastCapture: "2025-11-10T12:05:00"
                        },
                        {
                            id: "CAM-007",
                            name: "Camera Layer 3",
                            zone: "Zone A",
                            layers: ["3"],
                            status: "online",
                            lastCapture: "2025-11-10T12:10:00"
                        },
                        {
                            id: "CAM-008",
                            name: "Camera Layer 4",
                            zone: "Zone A",
                            layers: ["4"],
                            status: "online",
                            lastCapture: "2025-11-10T12:15:00"
                        }
                    ],
                    projects: ["‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏û‡∏∑‡∏ä‡∏ú‡∏±‡∏Å‡πÉ‡∏ö 2 ‡∏ä‡∏ô‡∏¥‡∏î (Sorrel, Frillice)"]
                }
            ];
            localStorage.setItem('farmlab_greenhouses', JSON.stringify(greenhouses));
        }

        // Projects data
        let projects = [
            {
                id: 1,
                name: '‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏û‡∏∑‡∏ä‡∏ú‡∏±‡∏Å‡πÉ‡∏ö 4 ‡∏ä‡∏ô‡∏¥‡∏î (‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏≠‡πã, ‡πÄ‡∏Ñ‡∏•, Sorrel, Frillice)',
                description: '‡∏ú‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏π‡∏Å: ‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏≠‡πã, ‡πÄ‡∏Ñ‡∏•, Sorrel, Frillice',
                startDate: '2025-03-01',
                owner: '‡∏ó‡∏µ‡∏°‡∏ß‡∏¥‡∏à‡∏±‡∏¢ Lab A',
                greenhouse: 'Lab A',
                template: 'leafy',
                rounds: [
                    {
                        id: 1,
                        name: 'Crop 1',
                        plantDate: '2025-03-01',
                        crops: [
                            { id: 1, name: '‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏≠‡πã', variety: '‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏≠‡πã 35 ‡∏ß‡∏±‡∏ô', location: 'Layer 1', recordCount: 8 },
                            { id: 2, name: '‡πÄ‡∏Ñ‡∏•', variety: '‡πÄ‡∏Ñ‡∏• 47 ‡∏ß‡∏±‡∏ô', location: 'Layer 2', recordCount: 7 },
                            { id: 3, name: 'Sorrel', variety: 'Sorrel 38-40 ‡∏ß‡∏±‡∏ô', location: 'Layer 3', recordCount: 6 },
                            { id: 4, name: 'Frillice', variety: 'Frillice 42 ‡∏ß‡∏±‡∏ô', location: 'Layer 1', recordCount: 6 }
                        ]
                    },
                    {
                        id: 2,
                        name: 'Crop 2',
                        plantDate: '2025-06-10',
                        crops: [
                            { id: 1, name: '‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏≠‡πã', variety: '‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏≠‡πã 35 ‡∏ß‡∏±‡∏ô', location: 'Layer 1', recordCount: 5 },
                            { id: 2, name: '‡πÄ‡∏Ñ‡∏•', variety: '‡πÄ‡∏Ñ‡∏• 47 ‡∏ß‡∏±‡∏ô', location: 'Layer 2', recordCount: 6 },
                            { id: 3, name: 'Sorrel', variety: 'Sorrel 40 ‡∏ß‡∏±‡∏ô', location: 'Layer 3', recordCount: 4 },
                            { id: 4, name: 'Frillice', variety: 'Frillice 42 ‡∏ß‡∏±‡∏ô', location: 'Layer 1', recordCount: 3 }
                        ]
                    },
                    {
                        id: 3,
                        name: 'Crop 3',
                        plantDate: '2025-09-01',
                        crops: [
                            { id: 1, name: '‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏≠‡πã', variety: '‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏≠‡πã 35 ‡∏ß‡∏±‡∏ô', location: 'Layer 1', recordCount: 0 },
                            { id: 2, name: '‡πÄ‡∏Ñ‡∏•', variety: '‡πÄ‡∏Ñ‡∏• 47 ‡∏ß‡∏±‡∏ô', location: 'Layer 2', recordCount: 0 },
                            { id: 3, name: 'Sorrel', variety: 'Sorrel 40 ‡∏ß‡∏±‡∏ô', location: 'Layer 3', recordCount: 0 },
                            { id: 4, name: 'Frillice', variety: 'Frillice 42 ‡∏ß‡∏±‡∏ô', location: 'Layer 1', recordCount: 0 }
                        ]
                    }
                ]
            },
            {
                id: 2,
                name: '‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏û‡∏∑‡∏ä‡∏ú‡∏±‡∏Å‡πÉ‡∏ö 2 ‡∏ä‡∏ô‡∏¥‡∏î (‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏≠‡πã, ‡πÄ‡∏Ñ‡∏•)',
                description: '‡∏ú‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏π‡∏Å: ‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏≠‡πã, ‡πÄ‡∏Ñ‡∏•',
                startDate: '2025-04-01',
                owner: '‡∏ó‡∏µ‡∏°‡∏ß‡∏¥‡∏à‡∏±‡∏¢ No.1',
                greenhouse: 'No.1',
                template: 'leafy',
                rounds: [
                    {
                        id: 1,
                        name: 'Crop 1',
                        plantDate: '2025-04-01',
                        crops: [
                            { id: 1, name: '‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏≠‡πã', variety: '‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏≠‡πã 35 ‡∏ß‡∏±‡∏ô', location: 'Layer 1-2', recordCount: 6 },
                            { id: 2, name: '‡πÄ‡∏Ñ‡∏•', variety: '‡πÄ‡∏Ñ‡∏• 47 ‡∏ß‡∏±‡∏ô', location: 'Layer 3-4', recordCount: 5 }
                        ]
                    },
                    {
                        id: 2,
                        name: 'Crop 2',
                        plantDate: '2025-07-01',
                        crops: [
                            { id: 1, name: '‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏≠‡πã', variety: '‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏≠‡πã 35 ‡∏ß‡∏±‡∏ô', location: 'Layer 1-2', recordCount: 0 },
                            { id: 2, name: '‡πÄ‡∏Ñ‡∏•', variety: '‡πÄ‡∏Ñ‡∏• 47 ‡∏ß‡∏±‡∏ô', location: 'Layer 3-4', recordCount: 0 }
                        ]
                    }
                ]
            },
            {
                id: 3,
                name: '‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏û‡∏∑‡∏ä‡∏ú‡∏±‡∏Å‡πÉ‡∏ö 2 ‡∏ä‡∏ô‡∏¥‡∏î (Sorrel, Frillice)',
                description: '‡∏ú‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏π‡∏Å: Sorrel, Frillice',
                startDate: '2025-05-01',
                owner: '‡∏ó‡∏µ‡∏°‡∏ß‡∏¥‡∏à‡∏±‡∏¢ Blue Room',
                greenhouse: 'Blue Room',
                template: 'leafy',
                rounds: [
                    {
                        id: 1,
                        name: 'Crop 1',
                        plantDate: '2025-05-01',
                        crops: [
                            { id: 1, name: 'Sorrel', variety: 'Sorrel 38-40 ‡∏ß‡∏±‡∏ô', location: 'Layer 1-2', recordCount: 7 },
                            { id: 2, name: 'Frillice', variety: 'Frillice 42 ‡∏ß‡∏±‡∏ô', location: 'Layer 3-4', recordCount: 6 }
                        ]
                    },
                    {
                        id: 2,
                        name: 'Crop 2',
                        plantDate: '2025-08-01',
                        crops: [
                            { id: 1, name: 'Sorrel', variety: 'Sorrel 40 ‡∏ß‡∏±‡∏ô', location: 'Layer 1-2', recordCount: 0 },
                            { id: 2, name: 'Frillice', variety: 'Frillice 42 ‡∏ß‡∏±‡∏ô', location: 'Layer 3-4', recordCount: 0 }
                        ]
                    }
                ]
            }
        ];

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            // Set dates if elements exist
            const projectStartDate = document.getElementById('projectStartDate');
            if (projectStartDate) projectStartDate.valueAsDate = new Date();
            
            const dataDate = document.getElementById('dataDate');
            if (dataDate) dataDate.valueAsDate = new Date();
            
            renderProjects();
            updateDataProjectOptions();
            initSensorCharts();
        });

        function showTab(tabName) {
            // ‡∏õ‡∏¥‡∏î settings dropdown ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà
            const settingsMenu = document.getElementById('settingsMenu');
            if (settingsMenu) {
                settingsMenu.classList.remove('show');
            }

            // ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å tab
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));

            // ‡πÅ‡∏™‡∏î‡∏á tab ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞ tab
            if (tabName === 'dashboard') {
                loadDashboard();
            } else if (tabName === 'projects') {
                renderProjects();
            } else if (tabName === 'data') {
                updateDataProjectOptions();
            } else if (tabName === 'greenhouses') {
                loadGreenhouses();
            }
        }

        // Placeholder functions ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Phase ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
        function loadDashboard() {
            console.log('Dashboard - ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÉ‡∏ô Phase 5');
        }

        function loadGreenhouses() {
            console.log('Loading Greenhouses...');
            renderGreenhouses();
        }

        // Sub-tab navigation
        function showGreenhousesSubTab(tabName) {
            document.querySelectorAll('.sub-tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('#greenhouses .sub-nav .sub-nav-button').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'devicesList') {
                renderAllDevices();
            }
        }

        // Render all devices (Controllers + Cameras)
        function renderAllDevices() {
            const grid = document.getElementById('devicesGrid');
            
            // Get all controllers
            const allControllers = greenhouses.flatMap(gh => 
                (gh.controllers || []).map(c => {
                    const zoneText = c.zone || '‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô';
                    return {
                        ...c, 
                        type: 'Controller',
                        icon: 'üéõÔ∏è',
                        greenhouse: gh.name, 
                        greenhouseId: gh.id,
                        details: `${(c.sensors || []).map(s => s.toUpperCase()).join(', ')} | ${zoneText}`
                    };
                })
            );

            // Get all cameras
            const allCameras = greenhouses.flatMap(gh => 
                (gh.cameras || []).map(c => ({ 
                    ...c, 
                    type: 'Camera',
                    icon: 'üì∑',
                    greenhouse: gh.name, 
                    greenhouseId: gh.id,
                    details: `Layers: ${c.layers.join(', ')}`
                }))
            );

            const allDevices = [...allControllers, ...allCameras];

            if (allDevices.length === 0) {
                grid.innerHTML = '<p style="color: #888; padding: 40px; text-align: center;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå<br>‡∏Ñ‡∏•‡∏¥‡∏Å "+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</p>';
                return;
            }

            grid.innerHTML = `
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                <th style="padding: 12px; text-align: left;">‡∏ä‡∏∑‡πà‡∏≠ / ID / ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                                <th style="padding: 12px; text-align: left;">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô</th>
                                <th style="padding: 12px; text-align: left;">Zone</th>
                                <th style="padding: 12px; text-align: left;">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
                                <th style="padding: 12px; text-align: left;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                <th style="padding: 12px; text-align: left; width: 120px;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${allDevices.map(d => `
                                <tr style="border-bottom: 1px solid #dee2e6; cursor: pointer;" onclick="viewDeviceDashboard('${d.type.toLowerCase()}', '${d.id}', ${d.greenhouseId})" title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">
                                    <td style="padding: 12px;">
                                        <div style="font-weight: 600;">${d.name}</div>
                                        <div style="font-size: 0.85em; color: #666; margin-top: 3px;">${d.id}</div>
                                        <div style="font-size: 0.85em; color: #888; margin-top: 3px;">${d.icon} ${d.type}</div>
                                    </td>
                                    <td style="padding: 12px;">${d.greenhouse}</td>
                                    <td style="padding: 12px;">${d.zone || '‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô'}</td>
                                    <td style="padding: 12px; font-size: 0.9em;">${d.details}</td>
                                    <td style="padding: 12px;">${d.status === 'online' ? 'üü¢ Online' : 'üî¥ Offline'}</td>
                                    <td style="padding: 12px;" onclick="event.stopPropagation()">
                                        <div style="display: flex; gap: 5px;">
                                            <button onclick="editDevice(${d.greenhouseId}, '${d.type}', '${d.id}')" style="padding: 5px 10px; background: #43cea2; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 0.85em;">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                                            <button onclick="deleteDevice(${d.greenhouseId}, '${d.type}', '${d.id}')" style="padding: 5px 10px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 0.85em;">üóëÔ∏è ‡∏•‡∏ö</button>
                                        </div>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // Show add device form
        function showAddDeviceForm() {
            const formHtml = `
                <div class="modal" id="deviceModal" style="display: block;">
                    <div class="modal-content" style="max-width: 600px;">
                        <h2>üéõÔ∏è ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</h2>
                        <form id="deviceForm" onsubmit="saveDevice(event)">
                            <div class="form-group">
                                <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå *</label>
                                <select id="deviceType" onchange="updateDeviceForm()" required>
                                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
                                    <option value="controller">üéõÔ∏è Smart Grow Controller</option>
                                    <option value="camera">üì∑ Camera</option>
                                </select>
                            </div>
                            <div id="deviceFormFields"></div>
                            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                                <button type="button" class="btn-secondary" onclick="closeDeviceModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                                <button type="submit" class="btn">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', formHtml);
        }

        // Update device form based on type
        function updateDeviceForm() {
            const type = document.getElementById('deviceType').value;
            const fieldsContainer = document.getElementById('deviceFormFields');

            if (!type) {
                fieldsContainer.innerHTML = '';
                return;
            }

            const commonFields = `
                <div class="form-group">
                    <label>ID ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå *</label>
                    <input type="text" id="deviceId" placeholder="‡πÄ‡∏ä‡πà‡∏ô GEN3-001 ‡∏´‡∏£‡∏∑‡∏≠ CAM-001" required>
                </div>
                <div class="form-group">
                    <label>‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå *</label>
                    <input type="text" id="deviceName" placeholder="‡πÄ‡∏ä‡πà‡∏ô Smart Grow Controller Gen3 #1" required>
                </div>
                <div class="form-group">
                    <label>‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô *</label>
                    <select id="deviceGreenhouse" onchange="updateDeviceZones()" required>
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô</option>
                        ${greenhouses.map(gh => `<option value="${gh.id}">${gh.name}</option>`).join('')}
                    </select>
                </div>
                <div class="form-group">
                    <label>Zone</label>
                    <select id="deviceZone">
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Zone</option>
                    </select>
                </div>
            `;

            if (type === 'controller') {
                fieldsContainer.innerHTML = commonFields + `
                    <div class="form-group">
                        <label>‡πÄ‡∏ã‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ</label>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <label><input type="checkbox" name="sensors" value="temperature" checked> Temperature</label>
                            <label><input type="checkbox" name="sensors" value="humidity" checked> Humidity</label>
                            <label><input type="checkbox" name="sensors" value="vpd" checked> VPD</label>
                            <label><input type="checkbox" name="sensors" value="co2"> CO2</label>
                            <label><input type="checkbox" name="sensors" value="ppfd"> PPFD</label>
                        </div>
                        <p style="color: #888; font-size: 0.85em; margin-top: 8px;">
                            üí° ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Zone = ‡∏ß‡∏±‡∏î‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô<br>
                            üí° ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Zone = ‡∏ß‡∏±‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Zone ‡∏ô‡∏±‡πâ‡∏ô
                        </p>
                    </div>
                `;
            } else if (type === 'camera') {
                fieldsContainer.innerHTML = commonFields + `
                    <div class="form-group">
                        <label>Layers ‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°</label>
                        <div id="deviceLayers" style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <p style="color: #888;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô</p>
                        </div>
                    </div>
                `;
            }
        }

        // Update zones based on selected greenhouse
        function updateDeviceZones() {
            const ghId = parseInt(document.getElementById('deviceGreenhouse').value);
            const zoneSelect = document.getElementById('deviceZone');
            
            if (!ghId) {
                zoneSelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Zone</option>';
                return;
            }

            const gh = greenhouses.find(g => g.id === ghId);
            zoneSelect.innerHTML = '<option value="">(‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏ - ‡∏ß‡∏±‡∏î‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô)</option>' +
                gh.zones.map(z => `<option value="Zone ${z}">Zone ${z}</option>`).join('');

            // Update layers for camera
            const type = document.getElementById('deviceType').value;
            if (type === 'camera') {
                const layersContainer = document.getElementById('deviceLayers');
                layersContainer.innerHTML = gh.layers.map(l => 
                    `<label><input type="checkbox" name="layers" value="${l}"> Layer ${l}</label>`
                ).join('');
            }
        }

        // Save device
        function saveDevice(event) {
            event.preventDefault();
            
            const type = document.getElementById('deviceType').value;
            const ghId = parseInt(document.getElementById('deviceGreenhouse').value);
            const greenhouse = greenhouses.find(g => g.id === ghId);
            
            if (!greenhouse) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô');
                return;
            }

            const id = document.getElementById('deviceId').value;
            const name = document.getElementById('deviceName').value;
            const zone = document.getElementById('deviceZone').value || null; // null = ‡∏ß‡∏±‡∏î‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏°

            if (type === 'controller') {
                const sensors = Array.from(document.querySelectorAll('input[name="sensors"]:checked')).map(cb => cb.value);
                
                if (sensors.length === 0) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ã‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ï‡∏±‡∏ß');
                    return;
                }

                // Create simple data structure
                const data = {};
                const sampleValues = {
                    temperature: 25,
                    humidity: 65,
                    vpd: 1.2,
                    co2: 850,
                    ppfd: 250
                };

                sensors.forEach(s => data[s] = sampleValues[s] + (Math.random() * 2 - 1));

                if (!greenhouse.controllers) greenhouse.controllers = [];
                greenhouse.controllers.push({
                    id,
                    name,
                    zone, // null = ‡∏£‡∏ß‡∏°, "Zone A" = ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Zone A
                    status: 'online',
                    sensors,
                    data
                });

                localStorage.setItem('farmlab_greenhouses', JSON.stringify(greenhouses));
                closeDeviceModal();
                renderAllDevices();
                
                const zoneText = zone ? zone : '‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô';
                alert(`‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° Controller ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!\n\n‡∏ß‡∏±‡∏î‡∏Ñ‡πà‡∏≤: ${zoneText}`);
            } else if (type === 'camera') {
                const layers = Array.from(document.querySelectorAll('input[name="layers"]:checked')).map(cb => cb.value);
                
                if (layers.length === 0) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Layer ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 Layer');
                    return;
                }

                if (!greenhouse.cameras) greenhouse.cameras = [];
                greenhouse.cameras.push({
                    id,
                    name,
                    zone,
                    layers,
                    status: 'online',
                    lastCapture: new Date().toISOString()
                });

                localStorage.setItem('farmlab_greenhouses', JSON.stringify(greenhouses));
                closeDeviceModal();
                renderAllDevices();
                alert('‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° Camera ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!');
            }
        }

        // Close device modal
        function closeDeviceModal() {
            const modal = document.getElementById('deviceModal');
            if (modal) modal.remove();
        }

        // Edit device
        function editDevice(greenhouseId, deviceType, deviceId) {
            const greenhouse = greenhouses.find(gh => gh.id === greenhouseId);
            if (!greenhouse) return;

            let device;
            if (deviceType === 'Controller') {
                device = greenhouse.controllers.find(c => c.id === deviceId);
            } else {
                device = greenhouse.cameras.find(c => c.id === deviceId);
            }

            if (!device) return;

            const formHtml = `
                <div class="modal" id="deviceModal" style="display: block;">
                    <div class="modal-content" style="max-width: 600px;">
                        <h2>‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</h2>
                        <form id="deviceForm" onsubmit="updateDevice(event, ${greenhouseId}, '${deviceType}', '${deviceId}')">
                            <div class="form-group">
                                <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</label>
                                <input type="text" value="${deviceType === 'Controller' ? 'üéõÔ∏è Smart Grow Controller' : 'üì∑ Camera'}" disabled>
                            </div>
                            <div class="form-group">
                                <label>ID ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</label>
                                <input type="text" value="${device.id}" disabled>
                            </div>
                            <div class="form-group">
                                <label>‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå *</label>
                                <input type="text" id="editDeviceName" value="${device.name}" required>
                            </div>
                            <div class="form-group">
                                <label>‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô</label>
                                <input type="text" value="${greenhouse.name}" disabled>
                            </div>
                            <div class="form-group">
                                <label>Zone ${deviceType === 'Controller' ? '(‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)' : '*'}</label>
                                <select id="editDeviceZone" ${deviceType === 'Camera' ? 'required' : ''}>
                                    ${deviceType === 'Controller' ? `<option value="" ${!device.zone ? 'selected' : ''}>(‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏ - ‡∏ß‡∏±‡∏î‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏°)</option>` : '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Zone</option>'}
                                    ${greenhouse.zones.map(z => `<option value="Zone ${z}" ${device.zone === `Zone ${z}` ? 'selected' : ''}>Zone ${z}</option>`).join('')}
                                </select>
                            </div>
                            ${deviceType === 'Controller' ? `
                                <div class="form-group">
                                    <label>‡πÄ‡∏ã‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ</label>
                                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                        <label><input type="checkbox" name="editSensors" value="temperature" ${device.sensors.includes('temperature') ? 'checked' : ''}> Temperature</label>
                                        <label><input type="checkbox" name="editSensors" value="humidity" ${device.sensors.includes('humidity') ? 'checked' : ''}> Humidity</label>
                                        <label><input type="checkbox" name="editSensors" value="vpd" ${device.sensors.includes('vpd') ? 'checked' : ''}> VPD</label>
                                        <label><input type="checkbox" name="editSensors" value="co2" ${device.sensors.includes('co2') ? 'checked' : ''}> CO2</label>
                                        <label><input type="checkbox" name="editSensors" value="ppfd" ${device.sensors.includes('ppfd') ? 'checked' : ''}> PPFD</label>
                                    </div>
                                </div>
                            ` : `
                                <div class="form-group">
                                    <label>Layers ‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°</label>
                                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                        ${greenhouse.layers.map(l => `
                                            <label><input type="checkbox" name="editLayers" value="${l}" ${device.layers.includes(l) ? 'checked' : ''}> Layer ${l}</label>
                                        `).join('')}
                                    </div>
                                </div>
                            `}
                            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                                <button type="button" class="btn-secondary" onclick="closeDeviceModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                                <button type="submit" class="btn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', formHtml);
        }

        // Update device
        function updateDevice(event, greenhouseId, deviceType, deviceId) {
            event.preventDefault();

            const greenhouse = greenhouses.find(gh => gh.id === greenhouseId);
            if (!greenhouse) return;

            const name = document.getElementById('editDeviceName').value;
            const zone = document.getElementById('editDeviceZone').value || null;

            if (deviceType === 'Controller') {
                const sensors = Array.from(document.querySelectorAll('input[name="editSensors"]:checked')).map(cb => cb.value);
                
                if (sensors.length === 0) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ã‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ï‡∏±‡∏ß');
                    return;
                }

                const controllerIndex = greenhouse.controllers.findIndex(c => c.id === deviceId);
                if (controllerIndex !== -1) {
                    greenhouse.controllers[controllerIndex] = {
                        ...greenhouse.controllers[controllerIndex],
                        name,
                        zone,
                        sensors
                    };
                }
            } else {
                const layers = Array.from(document.querySelectorAll('input[name="editLayers"]:checked')).map(cb => cb.value);
                
                if (layers.length === 0) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Layer ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 Layer');
                    return;
                }

                const cameraIndex = greenhouse.cameras.findIndex(c => c.id === deviceId);
                if (cameraIndex !== -1) {
                    greenhouse.cameras[cameraIndex] = {
                        ...greenhouse.cameras[cameraIndex],
                        name,
                        zone,
                        layers
                    };
                }
            }

            localStorage.setItem('farmlab_greenhouses', JSON.stringify(greenhouses));
            closeDeviceModal();
            renderAllDevices();
            alert('‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!');
        }

        // Delete device
        function deleteDevice(greenhouseId, deviceType, deviceId) {
            const greenhouse = greenhouses.find(gh => gh.id === greenhouseId);
            if (!greenhouse) return;

            let deviceName = '';
            if (deviceType === 'Controller') {
                const device = greenhouse.controllers.find(c => c.id === deviceId);
                deviceName = device ? device.name : deviceId;
            } else {
                const device = greenhouse.cameras.find(c => c.id === deviceId);
                deviceName = device ? device.name : deviceId;
            }

            if (!confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå "${deviceName}" ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n\n‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ`)) {
                return;
            }

            if (deviceType === 'Controller') {
                greenhouse.controllers = greenhouse.controllers.filter(c => c.id !== deviceId);
            } else {
                greenhouse.cameras = greenhouse.cameras.filter(c => c.id !== deviceId);
            }

            localStorage.setItem('farmlab_greenhouses', JSON.stringify(greenhouses));
            renderAllDevices();
            alert('‚úÖ ‡∏•‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
        }

        // View device dashboard
        function viewDeviceDashboard(type, deviceId, greenhouseId) {
            const greenhouse = greenhouses.find(gh => gh.id === greenhouseId);
            if (!greenhouse) return;

            if (type === 'controller') {
                showControllerDashboard(greenhouse, deviceId);
            } else if (type === 'camera') {
                showCameraDashboard(greenhouse, deviceId);
            }
        }

        // Show controller dashboard
        function showControllerDashboard(greenhouse, controllerId) {
            const controller = greenhouse.controllers.find(c => c.id === controllerId);
            if (!controller) return;

            // Get sensor data from controller.data.room (for sample data structure)
            const sensorData = controller.data?.room || {};
            const sensorList = controller.sensors || [];
            
            // Units mapping
            const units = {
                temperature: '¬∞C',
                humidity: '%',
                vpd: 'kPa',
                co2: 'ppm',
                ppfd: '¬µmol/m¬≤/s',
                ec: 'mS/cm',
                ph: ''
            };

            const dashboardHtml = `
                <div class="modal" id="deviceDashboardModal" style="display: block;">
                    <div class="modal-content" style="max-width: 1000px;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 20px;">
                            <div>
                                <h2>üéõÔ∏è ${controller.name}</h2>
                                <p style="color: #666; margin-top: 5px;">${greenhouse.name} - ${controller.zone || '‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô'}</p>
                            </div>
                            <button class="btn-secondary" onclick="closeDeviceDashboard()">‚úï</button>
                        </div>

                        <!-- Status Cards -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 20px;">
                            ${sensorList.map(sensor => {
                                const value = sensorData[sensor];
                                const unit = units[sensor] || '';
                                return `
                                    <div class="stat-card">
                                        <div class="stat-label">${sensor.toUpperCase()}</div>
                                        <div class="stat-value">${value !== undefined ? value.toFixed(1) : '-'}</div>
                                        <div style="font-size: 0.85em; color: #888; margin-top: 5px;">${unit}</div>
                                    </div>
                                `;
                            }).join('')}
                        </div>

                        <!-- Sensor Data Table -->
                        <div class="card" style="margin-bottom: 20px;">
                            <h3>üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ã‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (Room Level)</h3>
                            <div style="overflow-x: auto; margin-top: 15px;">
                                <table style="width: 100%; border-collapse: collapse;">
                                    <thead>
                                        <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                            <th style="padding: 12px; text-align: left;">‡πÄ‡∏ã‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå</th>
                                            <th style="padding: 12px; text-align: center;">‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</th>
                                            <th style="padding: 12px; text-align: center;">‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                                            <th style="padding: 12px; text-align: center;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                            <th style="padding: 12px; text-align: center;">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${sensorList.map(sensor => {
                                            const value = sensorData[sensor];
                                            const unit = units[sensor] || '-';
                                            return `
                                                <tr style="border-bottom: 1px solid #dee2e6;">
                                                    <td style="padding: 12px;">${sensor.toUpperCase()}</td>
                                                    <td style="padding: 12px; text-align: center; font-weight: 600; font-size: 1.1em; color: #43cea2;">
                                                        ${value !== undefined ? value.toFixed(1) : '-'}
                                                    </td>
                                                    <td style="padding: 12px; text-align: center;">${unit}</td>
                                                    <td style="padding: 12px; text-align: center;">üü¢ ‡∏õ‡∏Å‡∏ï‡∏¥</td>
                                                    <td style="padding: 12px; text-align: center; color: #888;">5 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</td>
                                                </tr>
                                            `;
                                        }).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Layer Data (if available) -->
                        ${controller.data && Object.keys(controller.data).filter(k => k.startsWith('layer')).length > 0 ? `
                            <div class="card" style="margin-bottom: 20px;">
                                <h3>üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏° Layer</h3>
                                <div style="overflow-x: auto; margin-top: 15px;">
                                    <table style="width: 100%; border-collapse: collapse; font-size: 0.9em;">
                                        <thead>
                                            <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                                <th style="padding: 10px; text-align: left;">Layer</th>
                                                ${sensorList.map(s => `<th style="padding: 10px; text-align: center;">${s.toUpperCase()}</th>`).join('')}
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${Object.keys(controller.data)
                                                .filter(k => k.startsWith('layer'))
                                                .sort((a, b) => {
                                                    const numA = parseInt(a.replace('layer', ''));
                                                    const numB = parseInt(b.replace('layer', ''));
                                                    return numA - numB;
                                                })
                                                .map(layerKey => {
                                                    const layerNum = layerKey.replace('layer', '');
                                                    const layerData = controller.data[layerKey];
                                                    return `
                                                        <tr style="border-bottom: 1px solid #dee2e6;">
                                                            <td style="padding: 10px; font-weight: 600;">Layer ${layerNum}</td>
                                                            ${sensorList.map(sensor => {
                                                                const value = layerData[sensor];
                                                                const displayValue = value !== undefined ? value.toFixed(1) : '-';
                                                                const unit = units[sensor] || '';
                                                                return `<td style="padding: 10px; text-align: center;">${displayValue} ${unit ? '<span style="color: #888; font-size: 0.85em;">' + unit + '</span>' : ''}</td>`;
                                                            }).join('')}
                                                        </tr>
                                                    `;
                                                }).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        ` : ''}

                        <!-- Charts -->
                        <div class="card">
                            <h3>üìà ‡∏Å‡∏£‡∏≤‡∏ü‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á 7 ‡∏ß‡∏±‡∏ô</h3>
                            <p style="color: #888; padding: 20px; text-align: center;">
                                ‡∏Å‡∏£‡∏≤‡∏ü‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠<br>
                                (‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡πà‡∏≠‡πÉ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ)
                            </p>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', dashboardHtml);
        }

        // Show camera dashboard
        function showCameraDashboard(greenhouse, cameraId) {
            const camera = greenhouse.cameras.find(c => c.id === cameraId);
            if (!camera) return;

            // Sample images
            const sampleImages = [
                'https://via.placeholder.com/300x200/43cea2/ffffff?text=Sample+1',
                'https://via.placeholder.com/300x200/185a9d/ffffff?text=Sample+2',
                'https://via.placeholder.com/300x200/43cea2/ffffff?text=Sample+3',
                'https://via.placeholder.com/300x200/185a9d/ffffff?text=Sample+4',
                'https://via.placeholder.com/300x200/43cea2/ffffff?text=Sample+5',
                'https://via.placeholder.com/300x200/185a9d/ffffff?text=Sample+6'
            ];

            const dashboardHtml = `
                <div class="modal" id="deviceDashboardModal" style="display: block;">
                    <div class="modal-content" style="max-width: 1000px;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 20px;">
                            <div>
                                <h2>üì∑ ${camera.name}</h2>
                                <p style="color: #666; margin-top: 5px;">${greenhouse.name} - ${camera.zone}</p>
                            </div>
                            <button class="btn-secondary" onclick="closeDeviceDashboard()">‚úï</button>
                        </div>

                        <!-- Camera Info -->
                        <div class="card" style="margin-bottom: 20px;">
                            <h3>üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡πâ‡∏≠‡∏á</h3>
                            <div style="margin-top: 15px; font-size: 1rem; color: #555; line-height: 2;">
                                <div><strong>ID:</strong> ${camera.id}</div>
                                <div><strong>Zone:</strong> ${camera.zone}</div>
                                <div><strong>Layers ‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°:</strong> ${camera.layers.map(l => `<span class="tag">Layer ${l}</span>`).join(' ')}</div>
                                <div><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> ${camera.status === 'online' ? 'üü¢ Online' : 'üî¥ Offline'}</div>
                                <div><strong>‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:</strong> 10 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</div>
                            </div>
                        </div>

                        <!-- Live View -->
                        <div class="card" style="margin-bottom: 20px;">
                            <h3>üìπ Live View</h3>
                            <div style="margin-top: 15px; background: #000; border-radius: 10px; aspect-ratio: 16/9; display: flex; align-items: center; justify-content: center; color: white;">
                                <div style="text-align: center;">
                                    <div style="font-size: 3rem;">üìπ</div>
                                    <div style="margin-top: 10px;">Live Stream</div>
                                    <div style="font-size: 0.9em; color: #888; margin-top: 5px;">(‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡πà‡∏≠)</div>
                                </div>
                            </div>
                        </div>

                        <!-- Gallery -->
                        <div class="card">
                            <h3>üì∑ ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏ñ‡πà‡∏≤‡∏¢‡πÇ‡∏î‡∏¢‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ</h3>
                            <div class="gallery-grid" style="margin-top: 15px;">
                                ${sampleImages.map((img, i) => `
                                    <div class="gallery-item" style="cursor: pointer;" onclick="alert('‡∏î‡∏π‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà')">
                                        <img src="${img}" alt="Photo ${i+1}" style="width: 100%; height: 200px; object-fit: cover; border-radius: 8px;">
                                        <div style="margin-top: 8px; font-size: 0.9em; color: #666;">
                                            <div>10/11/2025 ${10+i}:00</div>
                                            <div>Layer ${camera.layers[i % camera.layers.length]}</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', dashboardHtml);
        }

        // Close device dashboard
        function closeDeviceDashboard() {
            const modal = document.getElementById('deviceDashboardModal');
            if (modal) modal.remove();
        }

        // Render greenhouses list
        function renderGreenhouses() {
            const grid = document.getElementById('greenhousesGrid');
            
            if (greenhouses.length === 0) {
                grid.innerHTML = '<p style="color: #888; padding: 40px; text-align: center;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô<br>‡∏Ñ‡∏•‡∏¥‡∏Å "+ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</p>';
                return;
            }

            grid.innerHTML = greenhouses.map(gh => `
                <div class="project-card" onclick="viewGreenhouseDetail(${gh.id})">
                    <h3>${gh.name}</h3>
                    <div style="margin-top: 15px; font-size: 0.95em; color: #555; line-height: 1.8;">
                        <div><strong>‡∏Ç‡∏ô‡∏≤‡∏î:</strong> ${gh.size} ‡∏ï‡∏£.‡∏°.</div>
                        <div><strong>Zones:</strong> ${gh.zones.join(', ')}</div>
                        <div><strong>Layers:</strong> ${gh.layers.join(', ')}</div>
                        <div><strong>‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå:</strong> ${gh.controllers?.length || 0} Controllers, ${gh.cameras?.length || 0} Cameras</div>
                        <div><strong>‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£:</strong> ${gh.projects?.length || 0} ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</div>
                    </div>
                </div>
            `).join('');
        }

        // Temporary storage for selected zones and layers
        let selectedZones = [];
        let selectedLayers = [];

        // Add zone
        function addZone() {
            const select = document.getElementById('ghZoneSelect');
            const zone = select.value;
            
            if (!zone) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Zone');
                return;
            }

            if (selectedZones.includes(zone)) {
                alert('Zone ‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß');
                return;
            }

            selectedZones.push(zone);
            renderSelectedZones();
            select.value = '';
        }

        // Remove zone
        function removeZone(zone) {
            selectedZones = selectedZones.filter(z => z !== zone);
            renderSelectedZones();
        }

        // Render selected zones
        function renderSelectedZones() {
            const container = document.getElementById('selectedZones');
            container.innerHTML = selectedZones.map(zone => `
                <span class="tag">
                    Zone ${zone}
                    <button onclick="removeZone('${zone}')">√ó</button>
                </span>
            `).join('');
        }

        // Add layer
        function addLayer() {
            const select = document.getElementById('ghLayerSelect');
            const layer = select.value;
            
            if (!layer) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Layer');
                return;
            }

            if (selectedLayers.includes(layer)) {
                alert('Layer ‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß');
                return;
            }

            selectedLayers.push(layer);
            renderSelectedLayers();
            select.value = '';
        }

        // Remove layer
        function removeLayer(layer) {
            selectedLayers = selectedLayers.filter(l => l !== layer);
            renderSelectedLayers();
        }

        // Render selected layers
        function renderSelectedLayers() {
            const container = document.getElementById('selectedLayers');
            container.innerHTML = selectedLayers.map(layer => `
                <span class="tag">
                    Layer ${layer}
                    <button onclick="removeLayer('${layer}')">√ó</button>
                </span>
            `).join('');
        }

        // Temporary storage for devices in greenhouse form
        let tempControllers = [];
        let tempCameras = [];

        // Show greenhouse form
        function showGreenhouseForm() {
            // Reset selections
            selectedZones = [];
            selectedLayers = [];
            tempControllers = [];
            tempCameras = [];
            
            const formHtml = `
                <div class="modal" id="greenhouseModal" style="display: block;">
                    <div class="modal-content" style="max-width: 700px; max-height: 90vh; overflow-y: auto;">
                        <h2>üè† ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà</h2>
                        <form id="greenhouseForm" onsubmit="saveGreenhouse(event)">
                            <div class="form-group">
                                <label>‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô *</label>
                                <input type="text" id="ghName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô 1" required>
                            </div>
                            <div class="form-group">
                                <label>‡∏Ç‡∏ô‡∏≤‡∏î (‡∏ï‡∏£.‡∏°.) *</label>
                                <input type="number" id="ghSize" placeholder="‡πÄ‡∏ä‡πà‡∏ô 100" required>
                            </div>
                            <div class="form-group">
                                <label>Zones *</label>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <select id="ghZoneSelect" style="flex: 1;">
                                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Zone</option>
                                        <option value="A">Zone A</option>
                                        <option value="B">Zone B</option>
                                        <option value="C">Zone C</option>
                                        <option value="D">Zone D</option>
                                        <option value="E">Zone E</option>
                                    </select>
                                    <button type="button" class="btn" onclick="addZone()" style="padding: 10px 20px;">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                                </div>
                                <div id="selectedZones" style="margin-top: 10px; display: flex; gap: 5px; flex-wrap: wrap;"></div>
                            </div>
                            <div class="form-group">
                                <label>Layers *</label>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <select id="ghLayerSelect" style="flex: 1;">
                                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Layer</option>
                                        <option value="1">Layer 1</option>
                                        <option value="2">Layer 2</option>
                                        <option value="3">Layer 3</option>
                                        <option value="4">Layer 4</option>
                                        <option value="5">Layer 5</option>
                                    </select>
                                    <button type="button" class="btn" onclick="addLayer()" style="padding: 10px 20px;">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                                </div>
                                <div id="selectedLayers" style="margin-top: 10px; display: flex; gap: 5px; flex-wrap: wrap;"></div>
                            </div>

                            <!-- Device Section -->
                            <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #e0e0e0;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <label style="font-size: 1.1em; font-weight: 600;">üéõÔ∏è ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå </label>
                                    <button type="button" class="btn" onclick="showAddDeviceInForm()" style="padding: 8px 16px; font-size: 0.9em;">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</button>
                                </div>
                                <div id="tempDevicesList" style="background: #f8f9fa; padding: 15px; border-radius: 8px; min-height: 60px;">
                                    <p style="color: #888; margin: 0; text-align: center;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</p>
                                </div>
                            </div>

                            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                                <button type="button" class="btn-secondary" onclick="closeGreenhouseModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                                <button type="submit" class="btn">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', formHtml);
        }

        // Render temp devices list
        function renderTempDevicesList() {
            const container = document.getElementById('tempDevicesList');
            const allDevices = [
                ...tempControllers.map((c, idx) => ({ ...c, type: 'Controller', icon: 'üéõÔ∏è', originalIndex: idx })),
                ...tempCameras.map((c, idx) => ({ ...c, type: 'Camera', icon: 'üì∑', originalIndex: idx }))
            ];

            if (allDevices.length === 0) {
                container.innerHTML = '<p style="color: #888; margin: 0; text-align: center;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</p>';
                return;
            }

            container.innerHTML = allDevices.map((d) => {
                let details = '';
                if (d.type === 'Controller') {
                    const zoneText = d.zone ? d.zone : '‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô';
                    details = `${d.id} | ${zoneText} | ${d.sensors.join(', ').toUpperCase()}`;
                } else {
                    details = `${d.id} | ${d.zone} | Layers: ${d.layers.join(', ')}`;
                }
                
                return `
                    <div style="background: white; padding: 12px; border-radius: 6px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600;">${d.icon} ${d.name}</div>
                            <div style="font-size: 0.85em; color: #666; margin-top: 3px;">${details}</div>
                        </div>
                        <button type="button" onclick="removeTempDevice('${d.type}', ${d.originalIndex})" style="background: none; border: none; color: #ff4444; cursor: pointer; font-size: 1.2rem; padding: 5px;">√ó</button>
                    </div>
                `;
            }).join('');
        }

        // Remove temp device
        function removeTempDevice(type, index) {
            if (type === 'Controller') {
                tempControllers.splice(index, 1);
            } else {
                const controllerCount = tempControllers.length;
                tempCameras.splice(index - controllerCount, 1);
            }
            renderTempDevicesList();
        }

        // Show add device in form
        function showAddDeviceInForm() {
            if (selectedZones.length === 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Zone ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå');
                return;
            }

            const deviceFormHtml = `
                <div class="modal" id="deviceInFormModal" style="display: block; z-index: 1100;">
                    <div class="modal-content" style="max-width: 500px;">
                        <h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</h3>
                        <form id="deviceInForm" onsubmit="saveDeviceInForm(event)">
                            <div class="form-group">
                                <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå *</label>
                                <select id="deviceTypeInForm" onchange="updateDeviceFormInForm()" required>
                                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
                                    <option value="controller">üéõÔ∏è Smart Grow Controller</option>
                                    <option value="camera">üì∑ Camera</option>
                                </select>
                            </div>
                            <div id="deviceFormFieldsInForm"></div>
                            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                                <button type="button" class="btn-secondary" onclick="closeDeviceInFormModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                                <button type="submit" class="btn">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', deviceFormHtml);
        }

        // Update device form in form
        function updateDeviceFormInForm() {
            const type = document.getElementById('deviceTypeInForm').value;
            const fieldsContainer = document.getElementById('deviceFormFieldsInForm');

            if (!type) {
                fieldsContainer.innerHTML = '';
                return;
            }

            const zoneOptions = selectedZones.map(z => `<option value="${z}">Zone ${z}</option>`).join('');
            const layerOptions = selectedLayers.map(l => `<option value="${l}">Layer ${l}</option>`).join('');

            const commonFields = `
                <div class="form-group">
                    <label>ID ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå *</label>
                    <input type="text" id="deviceIdInForm" placeholder="‡πÄ‡∏ä‡πà‡∏ô GEN3-001 ‡∏´‡∏£‡∏∑‡∏≠ CAM-001" required>
                </div>
                <div class="form-group">
                    <label>‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå *</label>
                    <input type="text" id="deviceNameInForm" placeholder="‡πÄ‡∏ä‡πà‡∏ô Smart Grow Controller Gen3 #1" required>
                </div>
                <div class="form-group">
                    <label>Zone *</label>
                    <select id="deviceZoneInForm" required>
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Zone</option>
                        ${zoneOptions}
                    </select>
                </div>
            `;

            if (type === 'controller') {
                fieldsContainer.innerHTML = commonFields + `
                    <div class="form-group">
                        <label>‡πÄ‡∏ã‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ</label>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <label><input type="checkbox" name="sensorsInForm" value="temperature" checked> Temperature</label>
                            <label><input type="checkbox" name="sensorsInForm" value="humidity" checked> Humidity</label>
                            <label><input type="checkbox" name="sensorsInForm" value="vpd" checked> VPD</label>
                            <label><input type="checkbox" name="sensorsInForm" value="co2"> CO2</label>
                            <label><input type="checkbox" name="sensorsInForm" value="ppfd"> PPFD</label>
                        </div>
                        <p style="color: #888; font-size: 0.85em; margin-top: 8px;">
                            üí° ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Zone = ‡∏ß‡∏±‡∏î‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô
                        </p>
                    </div>
                `;
            } else if (type === 'camera') {
                fieldsContainer.innerHTML = commonFields + `
                    <div class="form-group">
                        <label>Layers ‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°</label>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            ${selectedLayers.map(l => `
                                <label><input type="checkbox" name="layersInForm" value="${l}"> Layer ${l}</label>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
        }

        // Save device in form
        function saveDeviceInForm(event) {
            event.preventDefault();
            
            const type = document.getElementById('deviceTypeInForm').value;
            const id = document.getElementById('deviceIdInForm').value;
            const name = document.getElementById('deviceNameInForm').value;
            const zone = document.getElementById('deviceZoneInForm').value;

            if (type === 'controller') {
                const dataCoverage = document.querySelector('input[name="dataCoverageInForm"]:checked')?.value;
                const sensors = Array.from(document.querySelectorAll('input[name="sensorsInForm"]:checked')).map(cb => cb.value);
                
                if (sensors.length === 0) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ã‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ï‡∏±‡∏ß');
                    return;
                }

                let controllerLayers = [];
                if (dataCoverage === 'room+layers') {
                    controllerLayers = Array.from(document.querySelectorAll('input[name="controllerLayersInForm"]:checked')).map(cb => cb.value);
                    if (controllerLayers.length === 0) {
                        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Layer ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 Layer');
                        return;
                    }
                }

                // Create data structure based on coverage type
                const data = {};
                const sampleValues = {
                    temperature: 25,
                    humidity: 65,
                    vpd: 1.2,
                    co2: 850,
                    ppfd: 250
                };

                if (dataCoverage === 'room') {
                    data.room = {};
                    sensors.forEach(s => data.room[s] = sampleValues[s]);
                } else if (dataCoverage === 'room+layers') {
                    data.room = {};
                    sensors.forEach(s => data.room[s] = sampleValues[s]);
                    controllerLayers.forEach(l => {
                        data[`layer${l}`] = {};
                        sensors.forEach(s => data[`layer${l}`][s] = sampleValues[s] + (Math.random() * 2 - 1));
                    });
                } else if (dataCoverage === 'zones') {
                    selectedZones.forEach(z => {
                        data[`zone${z}`] = {};
                        sensors.forEach(s => data[`zone${z}`][s] = sampleValues[s] + (Math.random() * 2 - 1));
                    });
                }

                tempControllers.push({
                    id,
                    name,
                    zone: `Zone ${zone}`,
                    dataCoverage,
                    layers: dataCoverage === 'room+layers' ? controllerLayers : [],
                    status: 'online',
                    sensors,
                    data
                });
            } else if (type === 'camera') {
                const layers = Array.from(document.querySelectorAll('input[name="layersInForm"]:checked')).map(cb => cb.value);
                
                if (layers.length === 0) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Layer ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 Layer');
                    return;
                }

                tempCameras.push({
                    id,
                    name,
                    zone: `Zone ${zone}`,
                    layers,
                    status: 'online',
                    lastCapture: new Date().toISOString()
                });
            }

            closeDeviceInFormModal();
            renderTempDevicesList();
        }

        // Update layer selection in form
        function updateLayerSelectionInForm() {
            const dataCoverage = document.querySelector('input[name="dataCoverageInForm"]:checked')?.value;
            const layerDiv = document.getElementById('layerSelectionInForm');
            
            if (dataCoverage === 'room+layers') {
                layerDiv.style.display = 'block';
            } else {
                layerDiv.style.display = 'none';
            }
        }

        // Close device in form modal
        function closeDeviceInFormModal() {
            const modal = document.getElementById('deviceInFormModal');
            if (modal) modal.remove();
        }

        // Save greenhouse
        function saveGreenhouse(event) {
            event.preventDefault();
            
            const name = document.getElementById('ghName').value;
            const size = document.getElementById('ghSize').value;

            if (selectedZones.length === 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Zone ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 Zone');
                return;
            }

            if (selectedLayers.length === 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Layer ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 Layer');
                return;
            }

            const greenhouse = {
                id: Date.now(),
                name: name,
                size: size,
                zones: [...selectedZones].sort(),
                layers: [...selectedLayers].sort((a, b) => a - b),
                controllers: [...tempControllers],
                cameras: [...tempCameras],
                projects: []
            };

            greenhouses.push(greenhouse);
            localStorage.setItem('farmlab_greenhouses', JSON.stringify(greenhouses));

            closeGreenhouseModal();
            renderGreenhouses();
            
            const deviceCount = tempControllers.length + tempCameras.length;
            alert(`‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!\n\n` +
                  `Zones: ${selectedZones.length} zones\n` +
                  `Layers: ${selectedLayers.length} layers\n` +
                  `‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå: ${deviceCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
        }

        // Close modal
        function closeGreenhouseModal() {
            const modal = document.getElementById('greenhouseModal');
            if (modal) modal.remove();
        }

        // View greenhouse detail
        function viewGreenhouseDetail(id) {
            const greenhouse = greenhouses.find(gh => gh.id === id);
            if (!greenhouse) return;

            const detailHtml = `
                <div class="modal" id="greenhouseDetailModal" style="display: block;">
                    <div class="modal-content" style="max-width: 800px;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 20px;">
                            <h2>üè† ${greenhouse.name}</h2>
                            <div style="display: flex; gap: 10px;">
                                <button class="btn-secondary" onclick="editGreenhouse(${greenhouse.id})">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                                <button class="btn-secondary" onclick="deleteGreenhouse(${greenhouse.id})" style="background: #dc3545;">üóëÔ∏è ‡∏•‡∏ö</button>
                                <button class="btn-secondary" onclick="closeGreenhouseDetailModal()">‚úï</button>
                            </div>
                        </div>

                        <div class="card" style="margin-bottom: 20px;">
                            <h3>üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</h3>
                            <div style="margin-top: 15px; font-size: 1rem; color: #555; line-height: 2.5;">
                                <div><strong>‡∏Ç‡∏ô‡∏≤‡∏î:</strong> ${greenhouse.size} ‡∏ï‡∏£.‡∏°.</div>
                                <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                                    <strong>Zones:</strong> 
                                    ${greenhouse.zones.map(z => `<span class="tag">Zone ${z}</span>`).join('')}
                                </div>
                                <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                                    <strong>Layers:</strong> 
                                    ${greenhouse.layers.map(l => `<span class="tag">Layer ${l}</span>`).join('')}
                                </div>
                            </div>
                        </div>

                        <div class="card" style="margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h3 style="margin: 0;">üéõÔ∏è ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (${(greenhouse.controllers?.length || 0) + (greenhouse.cameras?.length || 0)} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</h3>
                                <button class="btn" onclick="showAddDeviceToGreenhouse(${greenhouse.id})">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</button>
                            </div>
                            ${(greenhouse.controllers?.length > 0 || greenhouse.cameras?.length > 0) ? `
                                <div style="overflow-x: auto; margin-top: 15px;">
                                    <table style="width: 100%; border-collapse: collapse;">
                                        <thead>
                                            <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                                <th style="padding: 12px; text-align: left;">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                                                <th style="padding: 12px; text-align: left;">ID</th>
                                                <th style="padding: 12px; text-align: left;">‡∏ä‡∏∑‡πà‡∏≠</th>
                                                <th style="padding: 12px; text-align: left;">Zone</th>
                                                <th style="padding: 12px; text-align: left;">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
                                                <th style="padding: 12px; text-align: left;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${(greenhouse.controllers || []).map(c => `
                                                <tr style="border-bottom: 1px solid #dee2e6;">
                                                    <td style="padding: 12px;">üéõÔ∏è Controller</td>
                                                    <td style="padding: 12px;">${c.id}</td>
                                                    <td style="padding: 12px;">${c.name}</td>
                                                    <td style="padding: 12px;">${c.zone || '‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô'}</td>
                                                    <td style="padding: 12px; font-size: 0.9em;">
                                                        <div><strong>Sensors:</strong> ${(c.sensors || []).map(s => s.toUpperCase()).join(', ')}</div>
                                                        <div style="margin-top: 5px; color: #888;">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡πÅ‡∏ö‡∏ö‡∏£‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡πÅ‡∏¢‡∏Å Layer</div>
                                                    </td>
                                                    <td style="padding: 12px;">${c.status === 'online' ? 'üü¢ Online' : 'üî¥ Offline'}</td>
                                                </tr>
                                            `).join('')}
                                            ${(greenhouse.cameras || []).map(c => `
                                                <tr style="border-bottom: 1px solid #dee2e6;">
                                                    <td style="padding: 12px;">üì∑ Camera</td>
                                                    <td style="padding: 12px;">${c.id}</td>
                                                    <td style="padding: 12px;">${c.name}</td>
                                                    <td style="padding: 12px;">${c.zone}</td>
                                                    <td style="padding: 12px; font-size: 0.9em;">Layers: ${c.layers.join(', ')}</td>
                                                    <td style="padding: 12px;">${c.status === 'online' ? 'üü¢ Online' : 'üî¥ Offline'}</td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            ` : '<p style="color: #888; padding: 20px; text-align: center;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</p>'}
                        </div>

                        <div class="card">
                            <h3>üìÅ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ (${greenhouse.projects?.length || 0} ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£)</h3>
                            ${greenhouse.projects?.length > 0 ? `
                                <div class="projects-grid" style="margin-top: 15px;">
                                    ${greenhouse.projects.map(p => `
                                        <div class="project-card">
                                            <h3>${p}</h3>
                                            <div style="margin-top: 10px; font-size: 0.9em; color: #666;">
                                                <div>üìä Crops: 2 ‡∏£‡∏≠‡∏ö</div>
                                                <div>üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å: 45 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : '<p style="color: #888; padding: 20px; text-align: center;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</p>'}
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', detailHtml);
        }

        // Close detail modal
        function closeGreenhouseDetailModal() {
            const modal = document.getElementById('greenhouseDetailModal');
            if (modal) modal.remove();
        }

        // Edit greenhouse
        function editGreenhouse(id) {
            const greenhouse = greenhouses.find(gh => gh.id === id);
            if (!greenhouse) return;

            closeGreenhouseDetailModal();

            // Set current selections
            selectedZones = [...greenhouse.zones];
            selectedLayers = [...greenhouse.layers];
            tempControllers = [...(greenhouse.controllers || [])];
            tempCameras = [...(greenhouse.cameras || [])];

            const formHtml = `
                <div class="modal" id="greenhouseModal" style="display: block;">
                    <div class="modal-content" style="max-width: 700px; max-height: 90vh; overflow-y: auto;">
                        <h2>‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô</h2>
                        <form id="greenhouseForm" onsubmit="updateGreenhouse(event, ${id})">
                            <div class="form-group">
                                <label>‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô *</label>
                                <input type="text" id="ghName" value="${greenhouse.name}" required>
                            </div>
                            <div class="form-group">
                                <label>‡∏Ç‡∏ô‡∏≤‡∏î (‡∏ï‡∏£.‡∏°.) *</label>
                                <input type="number" id="ghSize" value="${greenhouse.size}" required>
                            </div>
                            <div class="form-group">
                                <label>Zones *</label>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <select id="ghZoneSelect" style="flex: 1;">
                                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Zone</option>
                                        <option value="A">Zone A</option>
                                        <option value="B">Zone B</option>
                                        <option value="C">Zone C</option>
                                        <option value="D">Zone D</option>
                                        <option value="E">Zone E</option>
                                    </select>
                                    <button type="button" class="btn" onclick="addZone()" style="padding: 10px 20px;">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                                </div>
                                <div id="selectedZones" style="margin-top: 10px; display: flex; gap: 5px; flex-wrap: wrap;"></div>
                            </div>
                            <div class="form-group">
                                <label>Layers *</label>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <select id="ghLayerSelect" style="flex: 1;">
                                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Layer</option>
                                        <option value="1">Layer 1</option>
                                        <option value="2">Layer 2</option>
                                        <option value="3">Layer 3</option>
                                        <option value="4">Layer 4</option>
                                        <option value="5">Layer 5</option>
                                    </select>
                                    <button type="button" class="btn" onclick="addLayer()" style="padding: 10px 20px;">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                                </div>
                                <div id="selectedLayers" style="margin-top: 10px; display: flex; gap: 5px; flex-wrap: wrap;"></div>
                            </div>

                            <!-- Device Section -->
                            <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #e0e0e0;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <label style="font-size: 1.1em; font-weight: 600;">üéõÔ∏è ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</label>
                                    <button type="button" class="btn" onclick="showAddDeviceInForm()" style="padding: 8px 16px; font-size: 0.9em;">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</button>
                                </div>
                                <div id="tempDevicesList" style="background: #f8f9fa; padding: 15px; border-radius: 8px; min-height: 60px;">
                                    <p style="color: #888; margin: 0; text-align: center;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
                                </div>
                            </div>

                            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                                <button type="button" class="btn-secondary" onclick="closeGreenhouseModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                                <button type="submit" class="btn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', formHtml);
            
            // Render existing selections
            renderSelectedZones();
            renderSelectedLayers();
            renderTempDevicesList();
        }

        // Update greenhouse
        function updateGreenhouse(event, id) {
            event.preventDefault();
            
            const name = document.getElementById('ghName').value;
            const size = document.getElementById('ghSize').value;

            if (selectedZones.length === 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Zone ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 Zone');
                return;
            }

            if (selectedLayers.length === 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Layer ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 Layer');
                return;
            }

            const index = greenhouses.findIndex(gh => gh.id === id);
            if (index !== -1) {
                greenhouses[index] = {
                    ...greenhouses[index],
                    name: name,
                    size: size,
                    zones: [...selectedZones].sort(),
                    layers: [...selectedLayers].sort((a, b) => a - b),
                    controllers: [...tempControllers],
                    cameras: [...tempCameras]
                };

                localStorage.setItem('farmlab_greenhouses', JSON.stringify(greenhouses));
                closeGreenhouseModal();
                renderGreenhouses();
                
                const deviceCount = tempControllers.length + tempCameras.length;
                alert(`‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!\n\n‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå: ${deviceCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
            }
        }

        // Delete greenhouse
        function deleteGreenhouse(id) {
            const greenhouse = greenhouses.find(gh => gh.id === id);
            if (!greenhouse) return;

            if (!confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô "${greenhouse.name}" ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n\n‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ`)) {
                return;
            }

            greenhouses = greenhouses.filter(gh => gh.id !== id);
            localStorage.setItem('farmlab_greenhouses', JSON.stringify(greenhouses));
            
            closeGreenhouseDetailModal();
            renderGreenhouses();
            alert('‚úÖ ‡∏•‡∏ö‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
        }

        // Show add device to existing greenhouse
        function showAddDeviceToGreenhouse(greenhouseId) {
            const greenhouse = greenhouses.find(gh => gh.id === greenhouseId);
            if (!greenhouse) return;

            const deviceFormHtml = `
                <div class="modal" id="addDeviceToGHModal" style="display: block; z-index: 1100;">
                    <div class="modal-content" style="max-width: 500px;">
                        <h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå - ${greenhouse.name}</h3>
                        <form id="addDeviceToGHForm" onsubmit="saveDeviceToGreenhouse(event, ${greenhouseId})">
                            <div class="form-group">
                                <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå *</label>
                                <select id="deviceTypeToGH" onchange="updateDeviceFormToGH(${greenhouseId})" required>
                                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
                                    <option value="controller">üéõÔ∏è Smart Grow Controller</option>
                                    <option value="camera">üì∑ Camera</option>
                                </select>
                            </div>
                            <div id="deviceFormFieldsToGH"></div>
                            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                                <button type="button" class="btn-secondary" onclick="closeAddDeviceToGHModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                                <button type="submit" class="btn">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', deviceFormHtml);
        }

        // Update device form to greenhouse
        function updateDeviceFormToGH(greenhouseId) {
            const greenhouse = greenhouses.find(gh => gh.id === greenhouseId);
            const type = document.getElementById('deviceTypeToGH').value;
            const fieldsContainer = document.getElementById('deviceFormFieldsToGH');

            if (!type) {
                fieldsContainer.innerHTML = '';
                return;
            }

            const zoneOptions = greenhouse.zones.map(z => `<option value="${z}">Zone ${z}</option>`).join('');
            const layerOptions = greenhouse.layers.map(l => `<option value="${l}">Layer ${l}</option>`).join('');

            const commonFields = `
                <div class="form-group">
                    <label>ID ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå *</label>
                    <input type="text" id="deviceIdToGH" placeholder="‡πÄ‡∏ä‡πà‡∏ô GEN3-001 ‡∏´‡∏£‡∏∑‡∏≠ CAM-001" required>
                </div>
                <div class="form-group">
                    <label>‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå *</label>
                    <input type="text" id="deviceNameToGH" placeholder="‡πÄ‡∏ä‡πà‡∏ô Smart Grow Controller Gen3 #1" required>
                </div>
                <div class="form-group">
                    <label>Zone *</label>
                    <select id="deviceZoneToGH" required>
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Zone</option>
                        ${zoneOptions}
                    </select>
                </div>
            `;

            if (type === 'controller') {
                fieldsContainer.innerHTML = commonFields + `
                    <div class="form-group">
                        <label>Data Coverage *</label>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <label style="cursor: pointer; padding: 8px; border: 2px solid #e0e0e0; border-radius: 6px;">
                                <input type="radio" name="dataCoverageToGH" value="room" onchange="updateLayerSelectionToGH(${greenhouseId})" checked>
                                <strong>Room Only</strong>
                            </label>
                            <label style="cursor: pointer; padding: 8px; border: 2px solid #e0e0e0; border-radius: 6px;">
                                <input type="radio" name="dataCoverageToGH" value="room+layers" onchange="updateLayerSelectionToGH(${greenhouseId})">
                                <strong>Room + Layers</strong>
                            </label>
                            <label style="cursor: pointer; padding: 8px; border: 2px solid #e0e0e0; border-radius: 6px;">
                                <input type="radio" name="dataCoverageToGH" value="zones" onchange="updateLayerSelectionToGH(${greenhouseId})">
                                <strong>Per Zone</strong>
                            </label>
                        </div>
                    </div>
                    <div class="form-group" id="layerSelectionToGH" style="display: none;">
                        <label>Layers ‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°</label>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            ${greenhouse.layers.map(l => `
                                <label><input type="checkbox" name="controllerLayersToGH" value="${l}"> Layer ${l}</label>
                            `).join('')}
                        </div>
                    </div>
                    <div class="form-group">
                        <label>‡πÄ‡∏ã‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ</label>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <label><input type="checkbox" name="sensorsToGH" value="temperature" checked> Temperature</label>
                            <label><input type="checkbox" name="sensorsToGH" value="humidity" checked> Humidity</label>
                            <label><input type="checkbox" name="sensorsToGH" value="vpd" checked> VPD</label>
                            <label><input type="checkbox" name="sensorsToGH" value="co2"> CO2</label>
                            <label><input type="checkbox" name="sensorsToGH" value="ppfd"> PPFD</label>
                        </div>
                    </div>
                `;
            } else if (type === 'camera') {
                fieldsContainer.innerHTML = commonFields + `
                    <div class="form-group">
                        <label>Layers ‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°</label>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            ${greenhouse.layers.map(l => `
                                <label><input type="checkbox" name="layersToGH" value="${l}"> Layer ${l}</label>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
        }

        // Update layer selection to GH
        function updateLayerSelectionToGH(greenhouseId) {
            const dataCoverage = document.querySelector('input[name="dataCoverageToGH"]:checked')?.value;
            const layerDiv = document.getElementById('layerSelectionToGH');
            
            if (dataCoverage === 'room+layers') {
                layerDiv.style.display = 'block';
            } else {
                layerDiv.style.display = 'none';
            }
        }

        // Save device to greenhouse
        function saveDeviceToGreenhouse(event, greenhouseId) {
            event.preventDefault();
            
            const greenhouse = greenhouses.find(gh => gh.id === greenhouseId);
            if (!greenhouse) return;

            const type = document.getElementById('deviceTypeToGH').value;
            const id = document.getElementById('deviceIdToGH').value;
            const name = document.getElementById('deviceNameToGH').value;
            const zone = document.getElementById('deviceZoneToGH').value;

            if (type === 'controller') {
                const dataCoverage = document.querySelector('input[name="dataCoverageToGH"]:checked')?.value;
                const sensors = Array.from(document.querySelectorAll('input[name="sensorsToGH"]:checked')).map(cb => cb.value);
                
                if (sensors.length === 0) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ã‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ï‡∏±‡∏ß');
                    return;
                }

                let controllerLayers = [];
                if (dataCoverage === 'room+layers') {
                    controllerLayers = Array.from(document.querySelectorAll('input[name="controllerLayersToGH"]:checked')).map(cb => cb.value);
                    if (controllerLayers.length === 0) {
                        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Layer ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 Layer');
                        return;
                    }
                }

                // Create data structure based on coverage type
                const data = {};
                const sampleValues = {
                    temperature: 25,
                    humidity: 65,
                    vpd: 1.2,
                    co2: 850,
                    ppfd: 250
                };

                if (dataCoverage === 'room') {
                    data.room = {};
                    sensors.forEach(s => data.room[s] = sampleValues[s]);
                } else if (dataCoverage === 'room+layers') {
                    data.room = {};
                    sensors.forEach(s => data.room[s] = sampleValues[s]);
                    controllerLayers.forEach(l => {
                        data[`layer${l}`] = {};
                        sensors.forEach(s => data[`layer${l}`][s] = sampleValues[s] + (Math.random() * 2 - 1));
                    });
                } else if (dataCoverage === 'zones') {
                    greenhouse.zones.forEach(z => {
                        data[`zone${z}`] = {};
                        sensors.forEach(s => data[`zone${z}`][s] = sampleValues[s] + (Math.random() * 2 - 1));
                    });
                }

                if (!greenhouse.controllers) greenhouse.controllers = [];
                greenhouse.controllers.push({
                    id,
                    name,
                    zone: `Zone ${zone}`,
                    dataCoverage,
                    layers: dataCoverage === 'room+layers' ? controllerLayers : [],
                    status: 'online',
                    sensors,
                    data
                });
            } else if (type === 'camera') {
                const layers = Array.from(document.querySelectorAll('input[name="layersToGH"]:checked')).map(cb => cb.value);
                
                if (layers.length === 0) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Layer ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 Layer');
                    return;
                }

                if (!greenhouse.cameras) greenhouse.cameras = [];
                greenhouse.cameras.push({
                    id,
                    name,
                    zone: `Zone ${zone}`,
                    layers,
                    status: 'online',
                    lastCapture: new Date().toISOString()
                });
            }

            localStorage.setItem('farmlab_greenhouses', JSON.stringify(greenhouses));
            closeAddDeviceToGHModal();
            closeGreenhouseDetailModal();
            viewGreenhouseDetail(greenhouseId);
            alert('‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!');
        }

        // Close add device to greenhouse modal
        function closeAddDeviceToGHModal() {
            const modal = document.getElementById('addDeviceToGHModal');
            if (modal) modal.remove();
        }

        function renderProjects() {
            const grid = document.getElementById('projectsGrid');
            grid.innerHTML = projects.map(project => {
                return `
                    <div class="project-card" onclick="viewProject(${project.id})">
                        <h3>${project.name}</h3>
                        <div style="margin-top: 15px; font-size: 0.95em; color: #555; line-height: 1.8;">
                            <div><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≠‡∏ö:</strong> ${project.rounds.length} ‡∏£‡∏≠‡∏ö</div>
                            <div><strong>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö:</strong> ${project.owner}</div>
                            <div><strong>‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô:</strong> ${project.greenhouse || '-'}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showProjectsList() {
            document.getElementById('projectsListView').classList.add('active');
            document.getElementById('createProjectView').classList.remove('active');
            document.getElementById('projectDetailView').classList.remove('active');
            renderProjects();
        }

        // Selected layers for project
        let selectedProjectLayers = [];
        
        // Add data field
        function addDataField() {
            const fieldName = document.getElementById('newFieldName').value.trim();
            const fieldUnit = document.getElementById('newFieldUnit').value.trim();
            
            if (!fieldName) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ü‡∏¥‡∏•‡∏î‡πå');
                return;
            }
            
            const fieldsList = document.getElementById('dataFieldsList');
            const fieldDiv = document.createElement('div');
            fieldDiv.className = 'field-item';
            fieldDiv.innerHTML = `
                ${fieldName}${fieldUnit ? ` (${fieldUnit})` : ''}
                <button type="button" onclick="removeDataField(this)" style="background: none; border: none; color: #ff4444; cursor: pointer; margin-left: 10px;">√ó</button>
            `;
            fieldsList.appendChild(fieldDiv);
            
            // Clear inputs
            document.getElementById('newFieldName').value = '';
            document.getElementById('newFieldUnit').value = '';
        }
        
        // Remove data field
        function removeDataField(button) {
            button.parentElement.remove();
        }

        function showCreateProject() {
            document.getElementById('projectsListView').classList.remove('active');
            document.getElementById('createProjectView').classList.add('active');
            
            // Load greenhouses into dropdown
            const ghSelect = document.getElementById('projectGreenhouse');
            ghSelect.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô --</option>' +
                greenhouses.map(gh => `<option value="${gh.id}">${gh.name}</option>`).join('');
            
            // Reset form
            selectedProjectLayers = [];
            document.getElementById('projectZone').innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Zone --</option>';
            document.getElementById('projectLayers').innerHTML = '<p style="color: #888; margin: 0;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡∏∞ Zone ‡∏Å‡πà‡∏≠‡∏ô</p>';
            document.getElementById('iotConnectionInfo').style.display = 'none';
            
            updateTemplatePreview();
        }

        // Update zones based on selected greenhouse
        function updateProjectZones() {
            const ghId = parseInt(document.getElementById('projectGreenhouse').value);
            const zoneSelect = document.getElementById('projectZone');
            
            if (!ghId) {
                zoneSelect.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Zone --</option>';
                document.getElementById('projectLayers').innerHTML = '<p style="color: #888; margin: 0;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡∏∞ Zone ‡∏Å‡πà‡∏≠‡∏ô</p>';
                document.getElementById('iotConnectionInfo').style.display = 'none';
                return;
            }

            const gh = greenhouses.find(g => g.id === ghId);
            zoneSelect.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Zone --</option>' +
                gh.zones.map(z => `<option value="${z}">Zone ${z}</option>`).join('');
            
            selectedProjectLayers = [];
            document.getElementById('projectLayers').innerHTML = '<p style="color: #888; margin: 0;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Zone ‡∏Å‡πà‡∏≠‡∏ô</p>';
            document.getElementById('iotConnectionInfo').style.display = 'none';
        }

        // Update layers based on selected zone
        function updateProjectLayers() {
            const ghId = parseInt(document.getElementById('projectGreenhouse').value);
            const zone = document.getElementById('projectZone').value;
            
            if (!ghId || !zone) {
                document.getElementById('projectLayers').innerHTML = '<p style="color: #888; margin: 0;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Zone ‡∏Å‡πà‡∏≠‡∏ô</p>';
                document.getElementById('iotConnectionInfo').style.display = 'none';
                return;
            }

            const gh = greenhouses.find(g => g.id === ghId);
            const layersContainer = document.getElementById('projectLayers');
            
            layersContainer.innerHTML = gh.layers.map(l => 
                `<label style="cursor: pointer;">
                    <input type="checkbox" name="projectLayers" value="${l}" onchange="updateIoTConnection(); updateDataSourcePreview();"> Layer ${l}
                </label>`
            ).join('');
            
            updateIoTConnection();
        }

        // Update IoT connection info
        function updateIoTConnection() {
            const ghId = parseInt(document.getElementById('projectGreenhouse').value);
            const zone = document.getElementById('projectZone').value;
            
            if (!ghId || !zone) {
                document.getElementById('iotConnectionInfo').style.display = 'none';
                document.getElementById('environmentDataInfo').style.display = 'none';
                return;
            }

            const gh = greenhouses.find(g => g.id === ghId);
            const selectedZone = `Zone ${zone}`;
            
            // Find controllers and cameras for this zone
            const controllers = (gh.controllers || []).filter(c => c.zone === selectedZone);
            const cameras = (gh.cameras || []).filter(c => c.zone === selectedZone);
            
            if (controllers.length === 0 && cameras.length === 0) {
                document.getElementById('iotConnectionInfo').style.display = 'none';
                document.getElementById('environmentDataInfo').style.display = 'none';
                return;
            }

            // Show devices
            let devicesHtml = '';
            if (controllers.length > 0) {
                devicesHtml += '<div style="margin-bottom: 8px;"><strong>üéõÔ∏è Controllers:</strong></div>';
                devicesHtml += controllers.map(c => 
                    `<div style="margin-left: 20px; margin-bottom: 5px;">‚Ä¢ ${c.name} (${c.id})</div>`
                ).join('');
            }
            if (cameras.length > 0) {
                devicesHtml += '<div style="margin-bottom: 8px; margin-top: 10px;"><strong>üì∑ Cameras:</strong></div>';
                devicesHtml += cameras.map(c => 
                    `<div style="margin-left: 20px; margin-bottom: 5px;">‚Ä¢ ${c.name} (${c.id})</div>`
                ).join('');
            }

            document.getElementById('iotDevicesList').innerHTML = devicesHtml;
            document.getElementById('iotConnectionInfo').style.display = 'block';

            // Show environment data if has controllers
            if (controllers.length > 0) {
                const controller = controllers[0]; // Use first controller
                
                const units = {
                    temperature: '¬∞C',
                    humidity: '%',
                    vpd: 'kPa',
                    co2: 'ppm',
                    ppfd: '¬µmol/m¬≤/s'
                };
                
                const sensors = (controller.sensors || [])
                    .map(sensor => `<div style="margin-left: 20px; margin-bottom: 5px;">‚Ä¢ ${sensor.toUpperCase()}${units[sensor] ? ` (${units[sensor]})` : ''}</div>`)
                    .join('');

                document.getElementById('environmentSensorsList').innerHTML = sensors;
                document.getElementById('environmentDataInfo').style.display = 'block';
                document.getElementById('useEnvironmentData').checked = true;
            } else {
                document.getElementById('environmentDataInfo').style.display = 'none';
            }
        }

        // Toggle environment data
        function toggleEnvironmentData() {
            const checked = document.getElementById('useEnvironmentData').checked;
            const preview = document.getElementById('environmentDataPreview');
            preview.style.display = checked ? 'block' : 'none';
        }

        // Update data source preview
        function updateDataSourcePreview() {
            const dataSource = document.querySelector('input[name="dataSource"]:checked')?.value;
            const preview = document.getElementById('dataSourcePreview');
            const selectedLayers = Array.from(document.querySelectorAll('input[name="projectLayers"]:checked')).map(cb => cb.value);
            
            if (dataSource === 'room') {
                preview.innerHTML = '‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å: <strong>room</strong> (‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡πâ‡∏≠‡∏á)';
            } else if (dataSource === 'layer') {
                if (selectedLayers.length > 0) {
                    preview.innerHTML = `‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å: <strong>layer${selectedLayers.join(', layer')}</strong> (‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏° Layer ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)`;
                } else {
                    preview.innerHTML = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Layer ‡∏Å‡πà‡∏≠‡∏ô';
                }
            }
        }

        function updateTemplatePreview() {
            // Template feature removed - no longer needed
            return;

            if (templateId === 'custom') {
                preview.innerHTML = '<p style="color: #888;">‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</p>';
            } else {
                const template = templates[templateId];
                preview.innerHTML = template.fields.map(field =>
                    `<div class="field-item">${field}</div>`
                ).join('');
            }
        }

        function createProject(event) {
            event.preventDefault();
            
            const ghId = parseInt(document.getElementById('projectGreenhouse').value);
            const zone = document.getElementById('projectZone').value;
            const selectedLayers = Array.from(document.querySelectorAll('input[name="projectLayers"]:checked')).map(cb => cb.value);
            
            if (selectedLayers.length === 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Layer ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 Layer');
                return;
            }

            // Get data fields
            const dataFields = Array.from(document.querySelectorAll('#dataFieldsList .field-item')).map(item => {
                const text = item.textContent.replace('√ó', '').trim();
                return text;
            });

            // Get greenhouse info
            const gh = greenhouses.find(g => g.id === ghId);
            const selectedZone = `Zone ${zone}`;
            const controllers = (gh.controllers || []).filter(c => c.zone === selectedZone);
            const cameras = (gh.cameras || []).filter(c => c.zone === selectedZone);
            const useEnvironment = document.getElementById('useEnvironmentData')?.checked || false;

            const dataSource = document.querySelector('input[name="dataSource"]:checked')?.value || 'room';

            const newProject = {
                id: Date.now(),
                name: document.getElementById('projectName').value,
                description: document.getElementById('projectDesc').value,
                owner: document.getElementById('projectOwner').value,
                greenhouse: {
                    id: ghId,
                    name: gh.name,
                    zone: zone,
                    layers: selectedLayers
                },
                iot: {
                    controllers: controllers.map(c => ({ id: c.id, name: c.name })),
                    cameras: cameras.map(c => ({ id: c.id, name: c.name })),
                    useEnvironmentData: useEnvironment,
                    dataSource: dataSource // 'room' ‡∏´‡∏£‡∏∑‡∏≠ 'layer'
                },
                dataFields: dataFields,
                status: 'active',
                crops: [],
                createdAt: new Date().toISOString()
            };
            
            projects.push(newProject);
            
            // Update greenhouse projects list
            if (!gh.projects) gh.projects = [];
            if (!gh.projects.includes(newProject.name)) {
                gh.projects.push(newProject.name);
                localStorage.setItem('farmlab_greenhouses', JSON.stringify(greenhouses));
            }
            
            const dataSourceText = dataSource === 'room' ? '‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡πâ‡∏≠‡∏á' : '‡∏Ñ‡πà‡∏≤‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏° Layer';
            
            alert('‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n' + 
                  `‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô: ${gh.name}\n` +
                  `Zone: ${zone}\n` +
                  `Layers: ${selectedLayers.join(', ')}\n` +
                  `Controllers: ${controllers.length} ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á\n` +
                  `Cameras: ${cameras.length} ‡∏ï‡∏±‡∏ß\n` +
                  `Environment Data: ${useEnvironment ? '‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (' + dataSourceText + ')' : '‡∏õ‡∏¥‡∏î'}`
            );
            
            showProjectsList();
            document.getElementById('projectForm').reset();
        }

        // Global variables for navigation
        let currentProjectId = null;
        let currentRoundId = null;
        let currentCropId = null;

        function viewProject(projectId) {
            currentProjectId = projectId;
            const project = projects.find(p => p.id === projectId);
            document.getElementById('projectsListView').classList.remove('active');
            document.getElementById('projectDetailView').classList.add('active');

            const content = document.getElementById('projectDetailContent');
            const totalRecords = project.rounds.reduce((sum, round) =>
                sum + round.crops.reduce((cropSum, crop) => cropSum + crop.recordCount, 0), 0);

            content.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 30px;">
                    <div>
                        <h2>${project.name}</h2>
                        <p style="color: #666; margin-top: 10px;">${project.description}</p>
                        <div style="margin-top: 15px; color: #888;">
                            <div>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°: ${project.startDate}</div>
                            <div>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö: ${project.owner}</div>
                            <div>Template: ${templates[project.template].name}</div>
                        </div>
                    </div>
                    <button class="btn" onclick="alert('‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡πá‡∏ß ‡πÜ ‡∏ô‡∏µ‡πâ')">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà</button>
                </div>

                <h3 style="margin-bottom: 15px;">‡∏£‡∏≠‡∏ö‡∏õ‡∏•‡∏π‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (${project.rounds.length} ‡∏£‡∏≠‡∏ö, ${totalRecords} ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å)</h3>
                <div class="projects-grid">
                    ${project.rounds.map(round => {
                        return `
                            <div class="project-card" onclick="viewRound(${projectId}, ${round.id})">
                                <div style="width: 100%; height: 180px; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-radius: 8px; margin-bottom: 15px;">
                                    <div style="font-size: 80px;">üå±</div>
                                </div>
                                <h3>${round.name}</h3>
                                <p style="color: #666; margin: 10px 0;">
                                    <strong>‡∏û‡∏∑‡∏ä:</strong> ${round.crops.length} ‡∏ä‡∏ô‡∏¥‡∏î (${round.crops.map(c => c.name).join(', ')})<br>
                                    <strong>‡∏ß‡∏±‡∏ô‡∏õ‡∏•‡∏π‡∏Å:</strong> ${round.plantDate}
                                </p>
                                <div class="project-meta">
                                    <span>${round.crops.reduce((sum, crop) => sum + crop.recordCount, 0)} ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function viewRound(projectId, roundId) {
            currentProjectId = projectId;
            currentRoundId = roundId;

            const project = projects.find(p => p.id === projectId);
            const round = project.rounds.find(r => r.id === roundId);

            const content = document.getElementById('projectDetailContent');
            content.innerHTML = `
                <button class="back-btn" onclick="backToProject()">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏î‡∏π‡∏£‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>

                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 30px;">
                    <div>
                        <h2>${project.name} - ${round.name}</h2>
                        <p style="color: #666; margin-top: 10px;">
                            <strong>‡∏û‡∏∑‡∏ä‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏π‡∏Å:</strong> ${round.crops.length} ‡∏ä‡∏ô‡∏¥‡∏î |
                            <strong>‡∏ß‡∏±‡∏ô‡∏õ‡∏•‡∏π‡∏Å:</strong> ${round.plantDate} |
                            <strong>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</strong> ${round.crops.reduce((sum, crop) => sum + crop.recordCount, 0)} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                        </p>
                    </div>
                </div>

                <h3 style="margin-bottom: 15px;">üå± ‡∏û‡∏∑‡∏ä‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (${round.crops.length} ‡∏ä‡∏ô‡∏¥‡∏î)</h3>
                <div class="projects-grid">
                    ${round.crops.map(crop => {
                        // Icon ‡πÅ‡∏•‡∏∞‡∏™‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡∏ô‡∏¥‡∏î‡∏û‡∏∑‡∏ä
                        const cropIcons = {
                            '‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏≠‡πã': { icon: 'ü•¨', bg: 'linear-gradient(135deg, #e8f5e9 0%, #a5d6a7 100%)' },
                            '‡πÄ‡∏Ñ‡∏•': { icon: 'ü•¨', bg: 'linear-gradient(135deg, #e0f2f1 0%, #80cbc4 100%)' },
                            'Sorrel': { icon: 'üåø', bg: 'linear-gradient(135deg, #fff3e0 0%, #ffb74d 100%)' },
                            'Frillice': { icon: 'ü•ó', bg: 'linear-gradient(135deg, #fce4ec 0%, #f48fb1 100%)' },
                            'default': { icon: 'üå±', bg: 'linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%)' }
                        };
                        const cropName = crop.name.includes('‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏≠‡πã') ? '‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏≠‡πã' :
                                       crop.name.includes('‡πÄ‡∏Ñ‡∏•') ? '‡πÄ‡∏Ñ‡∏•' :
                                       crop.name.includes('Sorrel') ? 'Sorrel' :
                                       crop.name.includes('Frillice') ? 'Frillice' : 'default';
                        const cropStyle = cropIcons[cropName];

                        return `
                            <div class="project-card" onclick="viewCrop(${projectId}, ${roundId}, ${crop.id})">
                                <div style="width: 100%; height: 180px; display: flex; align-items: center; justify-content: center; background: ${cropStyle.bg}; border-radius: 8px; margin-bottom: 15px;">
                                    <div style="font-size: 80px;">${cropStyle.icon}</div>
                                </div>
                                <h3>${crop.name}</h3>
                                <p style="color: #666; margin: 10px 0; font-size: 0.9rem;">
                                    <strong>‡∏™‡∏≤‡∏¢‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå:</strong> ${crop.variety}<br>
                                    <strong>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:</strong> ${crop.location}
                                </p>
                                <div class="project-meta">
                                    <span>${crop.recordCount} ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span>
                                    ${crop.recordCount > 0 ? '<span class="badge green">‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>' : '<span class="badge">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>'}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function viewCrop(projectId, roundId, cropId) {
            currentProjectId = projectId;
            currentRoundId = roundId;
            currentCropId = cropId;

            const project = projects.find(p => p.id === projectId);
            const round = project.rounds.find(r => r.id === roundId);
            const crop = round.crops.find(c => c.id === cropId);

            // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å Lab A Crop 3 Excel
            let sampleData = [];

            if (crop.recordCount >= 7) {
                // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡∏ä‡∏∏‡∏î - ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel (Crop 1)
                if (crop.name === '‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏≠‡πã') {
                    sampleData = [
                        { date: '2025-03-01', age: 1, stage: '‡πÄ‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏•‡πá‡∏î', height: '-', leafCount: '-', canopy: '-', weight: '-', env: 'Temp 25¬∞C, RH 61%', notes: '‡πÄ‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏•‡πá‡∏î ‡∏õ‡∏¥‡∏î‡∏ù‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏∑‡∏î 3 ‡∏ß‡∏±‡∏ô',
                          images: ['https://images.unsplash.com/photo-1464226184884-fa280b87c399?w=150', 'https://images.unsplash.com/photo-1464226184884-fa280b87c399?w=150'], imageCount: 2 },
                        { date: '2025-03-04', age: 4, stage: '‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏á', height: '-', leafCount: '2‡πÉ‡∏ö‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á', canopy: '-', weight: '-', env: '‡πÅ‡∏™‡∏á 14‡∏ä‡∏°./150ppfd', notes: '‡πÄ‡∏≠‡∏≤‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏á 14 ‡∏ä‡∏°. ‡∏ï‡πâ‡∏ô‡∏á‡∏≠‡∏Å‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå',
                          images: ['https://images.unsplash.com/photo-1464226184884-fa280b87c399?w=150', 'https://images.unsplash.com/photo-1464226184884-fa280b87c399?w=150'], imageCount: 2 },
                        { date: '2025-03-08', age: 8, stage: '‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•‡∏ô‡πâ‡∏≥‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô Layer 2', height: '-', leafCount: '-', canopy: '-', weight: '-', env: 'EC 1.4, pH 5.8', notes: '‡∏¢‡πâ‡∏≤‡∏¢‡∏•‡∏á‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• Layer 2',
                          images: ['https://images.unsplash.com/photo-1628773822503-930a7eaecf80?w=150'], imageCount: 1 },
                        { date: '2025-03-15', age: 15, stage: '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà 1', height: '-', leafCount: '-', canopy: '-', weight: '-', env: 'Temp 20.9¬∞C, RH 75%', notes: '‡∏¢‡πâ‡∏≤‡∏¢‡∏•‡∏á‡∏õ‡∏•‡∏π‡∏Å‡∏à‡∏£‡∏¥‡∏á',
                          images: ['https://images.unsplash.com/photo-1628773822503-930a7eaecf80?w=150', 'https://images.unsplash.com/photo-1628773822503-930a7eaecf80?w=150'], imageCount: 2 },
                        { date: '2025-03-22', age: 22, stage: '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà 2', height: '3.2-4.4', leafCount: '-', canopy: '5.8-10.3', weight: '-', env: 'EC 2.2, pH 5.7, CO2 723ppm', notes: '‡πÄ‡∏ï‡∏¥‡∏°‡∏ô‡πâ‡∏≥‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πã‡∏¢ 100ml',
                          images: ['https://images.unsplash.com/photo-1622383563227-04401ab4e5ea?w=150', 'https://images.unsplash.com/photo-1622383563227-04401ab4e5ea?w=150', 'https://images.unsplash.com/photo-1622383563227-04401ab4e5ea?w=150'], imageCount: 3 },
                        { date: '2025-03-29', age: 29, stage: '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà 3', height: '-', leafCount: '-', canopy: '-', weight: '-', env: 'EC 2.2, pH 5.9', notes: '‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á',
                          images: ['https://images.unsplash.com/photo-1622383563227-04401ab4e5ea?w=150'], imageCount: 1 },
                        { date: '2025-04-05', age: 35, stage: '‡πÄ‡∏Å‡πá‡∏ö‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï', height: '-', leafCount: '-', canopy: '-', weight: '120-165', env: 'Final EC 2.1, pH 6.1', notes: '‡πÄ‡∏Å‡πá‡∏ö‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï ‡∏≠‡∏≤‡∏¢‡∏∏ 35 ‡∏ß‡∏±‡∏ô',
                          images: ['https://images.unsplash.com/photo-1622383563227-04401ab4e5ea?w=150', 'https://images.unsplash.com/photo-1622383563227-04401ab4e5ea?w=150', 'https://images.unsplash.com/photo-1622383563227-04401ab4e5ea?w=150'], imageCount: 3 }
                    ];
                } else if (crop.name === '‡πÄ‡∏Ñ‡∏•') {
                    sampleData = [
                        { date: '2025-03-01', age: 1, stage: '‡πÄ‡∏û‡∏≤‡∏∞‡∏õ‡∏¥‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏∑‡∏î', height: '-', leafCount: '-', canopy: '-', weight: '-', env: 'EC 1.1, pH 5.5', notes: '‡πÄ‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏•‡πá‡∏î ‡∏õ‡∏¥‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏∑‡∏î',
                          images: ['https://images.unsplash.com/photo-1464226184884-fa280b87c399?w=150'], imageCount: 1 },
                        { date: '2025-03-04', age: 4, stage: '‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏á', height: '-', leafCount: '2‡πÉ‡∏ö‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á', canopy: '-', weight: '-', env: '‡πÅ‡∏™‡∏á 12‡∏ä‡∏°./150ppfd', notes: '‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏á 12 ‡∏ä‡∏°.',
                          images: ['https://images.unsplash.com/photo-1464226184884-fa280b87c399?w=150', 'https://images.unsplash.com/photo-1464226184884-fa280b87c399?w=150'], imageCount: 2 },
                        { date: '2025-03-08', age: 8, stage: '‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•‡∏ô‡πâ‡∏≥‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô Layer 1', height: '-', leafCount: '-', canopy: '-', weight: '-', env: 'EC 1.5, pH 6.0', notes: '‡∏¢‡πâ‡∏≤‡∏¢‡∏•‡∏á‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• Layer 1',
                          images: ['https://images.unsplash.com/photo-1515694346937-94d85e41e6f0?w=150'], imageCount: 1 },
                        { date: '2025-03-21', age: 21, stage: '‡∏Å‡πà‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏õ‡∏•‡∏π‡∏Å', height: '-', leafCount: '-', canopy: '-', weight: '-', env: 'EC 1.8, pH 5.6, Temp 20.8¬∞C', notes: '‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏õ‡∏•‡∏π‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡∏à‡∏£‡∏¥‡∏á',
                          images: ['https://images.unsplash.com/photo-1515694346937-94d85e41e6f0?w=150', 'https://images.unsplash.com/photo-1515694346937-94d85e41e6f0?w=150'], imageCount: 2 },
                        { date: '2025-03-29', age: 29, stage: '‡∏Ç‡∏∂‡πâ‡∏ô‡∏õ‡∏•‡∏π‡∏Å‡∏ö‡∏ô‡∏ä‡∏±‡πâ‡∏ô', height: '-', leafCount: '-', canopy: '-', weight: '-', env: 'EC 1.8, pH 5.8', notes: '‡∏¢‡πâ‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡∏õ‡∏•‡∏π‡∏Å‡∏ö‡∏ô‡∏ä‡∏±‡πâ‡∏ô‡∏à‡∏£‡∏¥‡∏á',
                          images: ['https://images.unsplash.com/photo-1515694346937-94d85e41e6f0?w=150', 'https://images.unsplash.com/photo-1515694346937-94d85e41e6f0?w=150'], imageCount: 2 },
                        { date: '2025-04-10', age: 41, stage: '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà 5', height: '-', leafCount: '-', canopy: '-', weight: '-', env: 'EC 1.9, pH 5.9', notes: '‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á',
                          images: ['https://images.unsplash.com/photo-1515694346937-94d85e41e6f0?w=150'], imageCount: 1 },
                        { date: '2025-04-17', age: 47, stage: '‡πÄ‡∏Å‡πá‡∏ö‡∏ú‡∏•', height: '-', leafCount: '-', canopy: '-', weight: '180-240', env: 'Final EC 1.8, pH 6.0', notes: '‡πÄ‡∏Å‡πá‡∏ö‡∏ú‡∏• ‡∏≠‡∏≤‡∏¢‡∏∏ 47 ‡∏ß‡∏±‡∏ô',
                          images: ['https://images.unsplash.com/photo-1515694346937-94d85e41e6f0?w=150', 'https://images.unsplash.com/photo-1515694346937-94d85e41e6f0?w=150', 'https://images.unsplash.com/photo-1515694346937-94d85e41e6f0?w=150'], imageCount: 3 }
                    ];
                } else if (crop.name === 'Sorrel') {
                    sampleData = [
                        { date: '2025-03-01', age: 1, stage: '‡πÄ‡∏û‡∏≤‡∏∞‡πÅ‡∏ä‡πà‡∏ô‡πâ‡∏≥ 4-5‡∏ä‡∏°.', height: '-', leafCount: '-', leafLength: '-', leafWidth: '-', weight: '-', env: '‡πÉ‡∏™‡πà‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡πÄ‡∏ä‡πá‡∏î‡∏ä‡∏π', notes: '‡πÅ‡∏ä‡πà‡πÄ‡∏°‡∏•‡πá‡∏î 4-5 ‡∏ä‡∏°. ‡πÉ‡∏™‡πà‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏õ‡∏¥‡∏î‡∏ù‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏∑‡∏î 5 ‡∏ß‡∏±‡∏ô',
                          images: ['https://images.unsplash.com/photo-1464226184884-fa280b87c399?w=150'], imageCount: 1 },
                        { date: '2025-03-06', age: 6, stage: '‡∏¢‡πâ‡∏≤‡∏¢‡πÉ‡∏™‡πà‡∏ü‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡∏ó‡∏µ‡πà‡∏°‡∏∑‡∏î 2‡∏ß‡∏±‡∏ô', height: '-', leafCount: '-', leafLength: '-', leafWidth: '-', weight: '-', env: '‡∏ó‡∏µ‡πà‡∏°‡∏∑‡∏î', notes: '‡∏¢‡πâ‡∏≤‡∏¢‡πÉ‡∏™‡πà‡∏ü‡∏≠‡∏á‡∏ô‡πâ‡∏≥ ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏á‡∏≠‡∏Å',
                          images: ['https://images.unsplash.com/photo-1464226184884-fa280b87c399?w=150'], imageCount: 1 },
                        { date: '2025-03-09', age: 9, stage: '‡∏¢‡πâ‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏á', height: '-', leafCount: '2‡πÉ‡∏ö‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á', leafLength: '-', leafWidth: '-', weight: '-', env: '‡πÅ‡∏™‡∏á 14‡∏ä‡∏°./150ppfd', notes: '‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏á',
                          images: ['https://images.unsplash.com/photo-1628773822503-930a7eaecf80?w=150'], imageCount: 1 },
                        { date: '2025-03-16', age: 16, stage: '‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 2', height: '-', leafCount: '-', leafLength: '-', leafWidth: '-', weight: '-', env: 'EC 1.6, pH 5.8', notes: '‡∏¢‡πâ‡∏≤‡∏¢‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 2',
                          images: ['https://images.unsplash.com/photo-1628773822503-930a7eaecf80?w=150', 'https://images.unsplash.com/photo-1628773822503-930a7eaecf80?w=150'], imageCount: 2 },
                        { date: '2025-03-28', age: 28, stage: '‡∏õ‡∏•‡∏π‡∏Å‡∏à‡∏£‡∏¥‡∏á Layer 2', height: '-', leafCount: '-', leafLength: '-', leafWidth: '-', weight: '-', env: 'EC 1.8, pH 6.0', notes: '‡∏¢‡πâ‡∏≤‡∏¢‡∏õ‡∏•‡∏π‡∏Å‡∏à‡∏£‡∏¥‡∏á Layer 2',
                          images: ['https://images.unsplash.com/photo-1628773822503-930a7eaecf80?w=150', 'https://images.unsplash.com/photo-1628773822503-930a7eaecf80?w=150'], imageCount: 2 },
                        { date: '2025-04-08', age: 40, stage: '‡πÄ‡∏Å‡πá‡∏ö‡∏ú‡∏• ‡∏≠‡∏≤‡∏¢‡∏∏ 40‡∏ß‡∏±‡∏ô', height: '-', leafCount: '-', leafLength: '-', leafWidth: '-', weight: '140-180', env: 'Final EC 1.9, pH 6.0', notes: '‡πÄ‡∏Å‡πá‡∏ö‡∏ú‡∏• ‡∏≠‡∏≤‡∏¢‡∏∏ 40 ‡∏ß‡∏±‡∏ô',
                          images: ['https://images.unsplash.com/photo-1628773822503-930a7eaecf80?w=150', 'https://images.unsplash.com/photo-1628773822503-930a7eaecf80?w=150', 'https://images.unsplash.com/photo-1628773822503-930a7eaecf80?w=150'], imageCount: 3 }
                    ];
                } else if (crop.name.includes('Frillice')) {
                    sampleData = [
                        { date: '2025-03-01', age: 1, stage: '‡πÄ‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏•‡πá‡∏î', height: '-', leafCount: '-', canopy: '-', weight: '-', env: '‡∏õ‡∏∏‡πã‡∏¢ Enshi new', notes: '‡πÄ‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏•‡πá‡∏î ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡∏î‡πÇ‡∏û‡πÅ‡∏ó‡∏™‡πÄ‡∏ã‡∏µ‡∏¢‡∏°',
                          images: ['https://images.unsplash.com/photo-1464226184884-fa280b87c399?w=150'], imageCount: 1 },
                        { date: '2025-03-04', age: 4, stage: '‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏á', height: '-', leafCount: '2‡πÉ‡∏ö‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á', canopy: '-', weight: '-', env: '‡πÅ‡∏™‡∏á 14‡∏ä‡∏°./150ppfd', notes: '‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏á',
                          images: ['https://images.unsplash.com/photo-1464226184884-fa280b87c399?w=150', 'https://images.unsplash.com/photo-1464226184884-fa280b87c399?w=150'], imageCount: 2 },
                        { date: '2025-03-08', age: 8, stage: '‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•‡∏ô‡πâ‡∏≥‡∏ô‡∏¥‡πà‡∏á', height: '-', leafCount: '3‡πÉ‡∏ö‡∏£‡∏ß‡∏°‡πÉ‡∏ö‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á', canopy: '-', weight: '-', env: 'EC 0.8, pH 5.9, CO2 1132ppm', notes: '‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• ‡πÉ‡∏ä‡πâ‡∏ô‡πâ‡∏≥‡∏ô‡∏¥‡πà‡∏á ‡∏õ‡∏∏‡πã‡∏¢ Enshi new',
                          images: ['https://images.unsplash.com/photo-1622383563227-04401ab4e5ea?w=150'], imageCount: 1 },
                        { date: '2025-03-15', age: 15, stage: '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà 1', height: '1.2-1.4', leafCount: '3-4‡πÉ‡∏ö‡∏£‡∏ß‡∏°‡πÉ‡∏ö‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á', canopy: '1.8-2.2', weight: '-', env: 'EC 1.3, pH 5.7', notes: '‡∏¢‡πâ‡∏≤‡∏¢‡∏•‡∏á‡∏õ‡∏•‡∏π‡∏Å/‡∏ñ‡∏≤‡∏î 18 ‡∏´‡∏•‡∏∏‡∏°',
                          images: ['https://images.unsplash.com/photo-1622383563227-04401ab4e5ea?w=150', 'https://images.unsplash.com/photo-1622383563227-04401ab4e5ea?w=150'], imageCount: 2 },
                        { date: '2025-03-22', age: 22, stage: '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà 2', height: '3.3-4.2', leafCount: '5-6‡πÉ‡∏ö‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î', canopy: '6.4-7.6', weight: '-', env: 'EC 0.9, pH 6.3, CO2 723ppm', notes: '‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏∏‡πã‡∏¢‡∏•‡∏î K ‡πÉ‡∏™‡πà‡∏ó‡πà‡∏≠‡∏™‡∏µ‡∏ü‡πâ‡∏≤',
                          images: ['https://images.unsplash.com/photo-1622383563227-04401ab4e5ea?w=150', 'https://images.unsplash.com/photo-1622383563227-04401ab4e5ea?w=150', 'https://images.unsplash.com/photo-1622383563227-04401ab4e5ea?w=150'], imageCount: 3 },
                        { date: '2025-04-12', age: 42, stage: '‡πÄ‡∏Å‡πá‡∏ö‡∏ú‡∏•', height: '-', leafCount: '-', canopy: '-', weight: '135-170', env: 'Final EC 0.9, pH 6.1', notes: '‡πÄ‡∏Å‡πá‡∏ö‡∏ú‡∏• ‡∏≠‡∏≤‡∏¢‡∏∏ 42 ‡∏ß‡∏±‡∏ô ‡∏™‡∏π‡∏ï‡∏£‡∏•‡∏î K ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                          images: ['https://images.unsplash.com/photo-1622383563227-04401ab4e5ea?w=150', 'https://images.unsplash.com/photo-1622383563227-04401ab4e5ea?w=150', 'https://images.unsplash.com/photo-1622383563227-04401ab4e5ea?w=150'], imageCount: 3 }
                    ];
                }
            } else if (crop.recordCount >= 3 && crop.recordCount < 7) {
                // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô - ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏•‡∏π‡∏Å‡∏≠‡∏¢‡∏π‡πà (Crop 2)
                if (crop.name === '‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏≠‡πã') {
                    sampleData = [
                        { date: '2025-06-10', age: 1, stage: '‡πÄ‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏•‡πá‡∏î', height: '-', leafCount: '-', canopy: '-', weight: '-', env: 'Temp 25¬∞C', notes: '‡πÄ‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏•‡πá‡∏î ‡∏õ‡∏¥‡∏î‡∏ù‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏∑‡∏î',
                          images: ['https://images.unsplash.com/photo-1464226184884-fa280b87c399?w=150'], imageCount: 1 },
                        { date: '2025-06-13', age: 4, stage: '‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏á', height: '-', leafCount: '2‡πÉ‡∏ö‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á', canopy: '-', weight: '-', env: '‡πÅ‡∏™‡∏á 14‡∏ä‡∏°.', notes: '‡πÄ‡∏≠‡∏≤‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏á 14 ‡∏ä‡∏°.',
                          images: ['https://images.unsplash.com/photo-1464226184884-fa280b87c399?w=150'], imageCount: 1 },
                        { date: '2025-06-17', age: 8, stage: '‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• Layer 3', height: '-', leafCount: '-', canopy: '-', weight: '-', env: 'EC 1.4, pH 5.8', notes: '‡∏¢‡πâ‡∏≤‡∏¢‡∏•‡∏á‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• Layer 3',
                          images: ['https://images.unsplash.com/photo-1628773822503-930a7eaecf80?w=150'], imageCount: 1 },
                        { date: '2025-06-24', age: 15, stage: '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà 1', height: '-', leafCount: '-', canopy: '-', weight: '-', env: 'Temp 21¬∞C', notes: '‡∏¢‡πâ‡∏≤‡∏¢‡∏õ‡∏•‡∏π‡∏Å‡∏à‡∏£‡∏¥‡∏á',
                          images: ['https://images.unsplash.com/photo-1628773822503-930a7eaecf80?w=150', 'https://images.unsplash.com/photo-1628773822503-930a7eaecf80?w=150'], imageCount: 2 },
                        { date: '2025-07-01', age: 22, stage: '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà 2', height: '2.9-3.8', leafCount: '-', canopy: '6.2-8.5', weight: '-', env: 'EC 2.2, pH 5.8', notes: '‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á (‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏•‡∏π‡∏Å)',
                          images: ['https://images.unsplash.com/photo-1622383563227-04401ab4e5ea?w=150', 'https://images.unsplash.com/photo-1622383563227-04401ab4e5ea?w=150'], imageCount: 2 }
                    ];
                } else if (crop.name === '‡πÄ‡∏Ñ‡∏•') {
                    sampleData = [
                        { date: '2025-06-10', age: 1, stage: '‡πÄ‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏•‡πá‡∏î', height: '-', leafCount: '-', canopy: '-', weight: '-', env: 'Temp 25¬∞C', notes: '‡πÄ‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏•‡πá‡∏î ‡∏õ‡∏¥‡∏î‡∏ù‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏∑‡∏î',
                          images: ['https://images.unsplash.com/photo-1464226184884-fa280b87c399?w=150'], imageCount: 1 },
                        { date: '2025-06-13', age: 4, stage: '‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏á', height: '-', leafCount: '2‡πÉ‡∏ö‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á', canopy: '-', weight: '-', env: '‡πÅ‡∏™‡∏á 12‡∏ä‡∏°./150ppfd', notes: '‡πÄ‡∏≠‡∏≤‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏á 12 ‡∏ä‡∏°.',
                          images: ['https://images.unsplash.com/photo-1464226184884-fa280b87c399?w=150', 'https://images.unsplash.com/photo-1464226184884-fa280b87c399?w=150'], imageCount: 2 },
                        { date: '2025-06-17', age: 8, stage: '‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• Layer 3', height: '-', leafCount: '3-4‡πÉ‡∏ö‡∏£‡∏ß‡∏°‡πÉ‡∏ö‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á', canopy: '-', weight: '-', env: 'EC 1.4, pH 6.0', notes: '‡∏¢‡πâ‡∏≤‡∏¢‡∏•‡∏á‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• Layer 3',
                          images: ['https://images.unsplash.com/photo-1515694346937-94d85e41e6f0?w=150', 'https://images.unsplash.com/photo-1515694346937-94d85e41e6f0?w=150'], imageCount: 2 },
                        { date: '2025-06-24', age: 15, stage: '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà 1', height: '-', leafCount: '-', canopy: '-', weight: '-', env: 'Temp 20¬∞C', notes: '‡∏¢‡πâ‡∏≤‡∏¢‡∏õ‡∏•‡∏π‡∏Å‡∏à‡∏£‡∏¥‡∏á',
                          images: ['https://images.unsplash.com/photo-1515694346937-94d85e41e6f0?w=150'], imageCount: 1 },
                        { date: '2025-07-01', age: 22, stage: '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà 2', height: '9.8-12.5', leafCount: '-', canopy: '8.5-11.2', weight: '-', env: 'EC 1.8, pH 6.2', notes: '‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á (‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏•‡∏π‡∏Å)',
                          images: ['https://images.unsplash.com/photo-1515694346937-94d85e41e6f0?w=150', 'https://images.unsplash.com/photo-1515694346937-94d85e41e6f0?w=150'], imageCount: 2 }
                    ];
                } else if (crop.name === 'Sorrel') {
                    sampleData = [
                        { date: '2025-06-10', age: 1, stage: '‡πÄ‡∏û‡∏≤‡∏∞‡πÅ‡∏ä‡πà‡∏ô‡πâ‡∏≥', height: '-', leafCount: '-', leafLength: '-', leafWidth: '-', weight: '-', env: '‡πÅ‡∏ä‡πà‡∏ô‡πâ‡∏≥ 4-5 ‡∏ä‡∏°.', notes: '‡πÅ‡∏ä‡πà‡∏ô‡πâ‡∏≥ ‡∏õ‡∏¥‡∏î‡∏ù‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏∑‡∏î',
                          images: ['https://images.unsplash.com/photo-1464226184884-fa280b87c399?w=150'], imageCount: 1 },
                        { date: '2025-06-15', age: 6, stage: '‡∏õ‡∏¥‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏∑‡∏î', height: '-', leafCount: '-', leafLength: '-', leafWidth: '-', weight: '-', env: '‡∏õ‡∏¥‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏∑‡∏î 5 ‡∏ß‡∏±‡∏ô', notes: '‡∏õ‡∏¥‡∏î‡∏ù‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏∑‡∏î (‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏á‡∏≠‡∏Å)',
                          images: ['https://images.unsplash.com/photo-1464226184884-fa280b87c399?w=150'], imageCount: 1 },
                        { date: '2025-06-16', age: 7, stage: '‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏á', height: '-', leafCount: '2‡πÉ‡∏ö‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á', leafLength: '-', leafWidth: '-', weight: '-', env: '‡πÅ‡∏™‡∏á 14‡∏ä‡∏°.', notes: '‡πÄ‡∏≠‡∏≤‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏á 14 ‡∏ä‡∏°.',
                          images: ['https://images.unsplash.com/photo-1628773822503-930a7eaecf80?w=150'], imageCount: 1 },
                        { date: '2025-06-23', age: 14, stage: '‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•', height: '-', leafCount: '4-5‡πÉ‡∏ö‡∏£‡∏ß‡∏°‡πÉ‡∏ö‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á', leafLength: '2.8-3.5', leafWidth: '1.5-2.2', weight: '-', env: 'EC 1.6, pH 5.8', notes: '‡∏¢‡πâ‡∏≤‡∏¢‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•',
                          images: ['https://images.unsplash.com/photo-1628773822503-930a7eaecf80?w=150', 'https://images.unsplash.com/photo-1628773822503-930a7eaecf80?w=150'], imageCount: 2 },
                        { date: '2025-07-01', age: 22, stage: '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà 2', height: '-', leafCount: '-', leafLength: '6.5-8.2', leafWidth: '4.2-5.5', weight: '-', env: 'EC 1.9, pH 6.0', notes: '‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á (‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏•‡∏π‡∏Å)',
                          images: ['https://images.unsplash.com/photo-1628773822503-930a7eaecf80?w=150', 'https://images.unsplash.com/photo-1628773822503-930a7eaecf80?w=150'], imageCount: 2 }
                    ];
                } else if (crop.name.includes('Frillice')) {
                    sampleData = [
                        { date: '2025-06-10', age: 1, stage: '‡πÄ‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏•‡πá‡∏î', height: '-', leafCount: '-', canopy: '-', weight: '-', env: '‡∏õ‡∏∏‡πã‡∏¢ Enshi new', notes: '‡πÄ‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏•‡πá‡∏î ‡∏õ‡∏¥‡∏î‡∏ù‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏∑‡∏î',
                          images: ['https://images.unsplash.com/photo-1464226184884-fa280b87c399?w=150'], imageCount: 1 },
                        { date: '2025-06-13', age: 4, stage: '‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏á', height: '-', leafCount: '2‡πÉ‡∏ö‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á', canopy: '-', weight: '-', env: '‡πÅ‡∏™‡∏á 14‡∏ä‡∏°.', notes: '‡πÄ‡∏≠‡∏≤‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏á 14 ‡∏ä‡∏°.',
                          images: ['https://images.unsplash.com/photo-1464226184884-fa280b87c399?w=150'], imageCount: 1 },
                        { date: '2025-06-19', age: 10, stage: '‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•‡∏ô‡πâ‡∏≥‡∏ô‡∏¥‡πà‡∏á', height: '-', leafCount: '3-4‡πÉ‡∏ö‡∏£‡∏ß‡∏°‡πÉ‡∏ö‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á', canopy: '-', weight: '-', env: 'EC 0.8, pH 5.5', notes: '‡∏¢‡πâ‡∏≤‡∏¢‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• ‡πÉ‡∏™‡πà‡∏õ‡∏∏‡πã‡∏¢‡∏ó‡πà‡∏≠‡∏™‡∏µ‡∏ü‡πâ‡∏≤',
                          images: ['https://images.unsplash.com/photo-1622383563227-04401ab4e5ea?w=150', 'https://images.unsplash.com/photo-1622383563227-04401ab4e5ea?w=150'], imageCount: 2 },
                        { date: '2025-06-26', age: 17, stage: '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà 1', height: '-', leafCount: '-', canopy: '-', weight: '-', env: 'Temp 22¬∞C', notes: '‡∏¢‡πâ‡∏≤‡∏¢‡∏õ‡∏•‡∏π‡∏Å‡∏à‡∏£‡∏¥‡∏á',
                          images: ['https://images.unsplash.com/photo-1622383563227-04401ab4e5ea?w=150'], imageCount: 1 },
                        { date: '2025-07-03', age: 24, stage: '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà 2', height: '8.5-11.2', leafCount: '-', canopy: '7.2-9.8', weight: '-', env: 'EC 1.3, pH 5.8', notes: '‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏∏‡πã‡∏¢‡∏•‡∏î K (‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏•‡∏π‡∏Å)',
                          images: ['https://images.unsplash.com/photo-1622383563227-04401ab4e5ea?w=150', 'https://images.unsplash.com/photo-1622383563227-04401ab4e5ea?w=150'], imageCount: 2 }
                    ];
                }
            }

            const content = document.getElementById('projectDetailContent');
            content.innerHTML = `
                <button class="back-btn" onclick="backToRound()">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏î‡∏π‡∏û‡∏∑‡∏ä‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>

                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 30px;">
                    <div>
                        <h2>${project.name} - ${round.name} - ${crop.name}</h2>
                        <p style="color: #666; margin-top: 10px;">
                            <strong>‡∏™‡∏≤‡∏¢‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå:</strong> ${crop.variety} |
                            <strong>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:</strong> ${crop.location} |
                            <strong>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å:</strong> ${crop.recordCount} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                        </p>
                    </div>
                    <button class="btn" onclick="alert('‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡πá‡∏ß ‡πÜ ‡∏ô‡∏µ‡πâ')">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏´‡∏°‡πà</button>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 15px;">üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï</h3>
                    ${sampleData.length > 0 ? `
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                                <thead>
                                    <tr style="background: #f8f9fa;">
                                        <th style="padding: 10px; text-align: left; border: 1px solid #e0e0e0;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                        <th style="padding: 10px; text-align: center; border: 1px solid #e0e0e0;">‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏ß‡∏±‡∏ô)</th>
                                        <th style="padding: 10px; text-align: left; border: 1px solid #e0e0e0;">‡∏£‡∏∞‡∏¢‡∏∞</th>
                                        <th style="padding: 10px; text-align: center; border: 1px solid #e0e0e0;">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á (cm)</th>
                                        <th style="padding: 10px; text-align: center; border: 1px solid #e0e0e0;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÉ‡∏ö</th>
                                        ${crop.name === 'Sorrel' ?
                                            '<th style="padding: 10px; text-align: center; border: 1px solid #e0e0e0;">‡∏¢‡∏≤‡∏ß‡πÉ‡∏ö (cm)</th><th style="padding: 10px; text-align: center; border: 1px solid #e0e0e0;">‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÉ‡∏ö (cm)</th>' :
                                            '<th style="padding: 10px; text-align: center; border: 1px solid #e0e0e0;">‡∏ó‡∏£‡∏á‡∏û‡∏∏‡πà‡∏° (cm)</th>'
                                        }
                                        <th style="padding: 10px; text-align: center; border: 1px solid #e0e0e0;">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (g)</th>
                                        <th style="padding: 10px; text-align: center; border: 1px solid #e0e0e0;">‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°</th>
                                        <th style="padding: 10px; text-align: center; border: 1px solid #e0e0e0;">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</th>
                                        <th style="padding: 10px; text-align: left; border: 1px solid #e0e0e0;">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${sampleData.map((data, index) => `
                                        <tr>
                                            <td style="padding: 10px; border: 1px solid #e0e0e0;">${data.date}</td>
                                            <td style="padding: 10px; text-align: center; border: 1px solid #e0e0e0;">${data.age}</td>
                                            <td style="padding: 10px; border: 1px solid #e0e0e0;">${data.stage}</td>
                                            <td style="padding: 10px; text-align: center; border: 1px solid #e0e0e0;">${data.height}</td>
                                            <td style="padding: 10px; text-align: center; border: 1px solid #e0e0e0;">${data.leafCount}</td>
                                            ${crop.name === 'Sorrel' ?
                                                `<td style="padding: 10px; text-align: center; border: 1px solid #e0e0e0;">${data.leafLength}</td><td style="padding: 10px; text-align: center; border: 1px solid #e0e0e0;">${data.leafWidth}</td>` :
                                                `<td style="padding: 10px; text-align: center; border: 1px solid #e0e0e0;">${data.canopy}</td>`
                                            }
                                            <td style="padding: 10px; text-align: center; border: 1px solid #e0e0e0;">${data.weight}</td>
                                            <td style="padding: 10px; text-align: center; border: 1px solid #e0e0e0; font-size: 0.8rem;">${data.env}</td>
                                            <td style="padding: 10px; text-align: center; border: 1px solid #e0e0e0;">
                                                <button onclick="showImages(${index})"
                                                        style="background: #43cea2; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 0.85rem;">
                                                    üì∑ ‡∏î‡∏π‡∏£‡∏π‡∏õ (${data.imageCount})
                                                </button>
                                            </td>
                                            <td style="padding: 10px; border: 1px solid #e0e0e0; font-size: 0.85rem;">${data.notes}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    ` : '<p style="color: #888; padding: 20px; text-align: center;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• - ‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô</p>'}
                </div>

                <!-- Image Modal -->
                <div id="imageModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; padding: 20px; overflow-y: auto;">
                    <div style="max-width: 900px; margin: 40px auto; position: relative;">
                        <button onclick="closeImageModal()"
                                style="position: absolute; top: -40px; right: 0; background: white; color: #333; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: 600;">
                            ‚úï ‡∏õ‡∏¥‡∏î
                        </button>
                        <div id="imageModalContent" style="background: white; padding: 30px; border-radius: 15px;">
                        </div>
                    </div>
                </div>

                <script>
                    const recordImages_${projectId}_${roundId}_${cropId} = ${JSON.stringify(sampleData.map(d => d.images))};
                    const recordData_${projectId}_${roundId}_${cropId} = ${JSON.stringify(sampleData.map(d => ({ date: d.date })))};

                    window.showImages = function(recordIndex) {
                        const modal = document.getElementById('imageModal');
                        const content = document.getElementById('imageModalContent');
                        const images = recordImages_${projectId}_${roundId}_${cropId}[recordIndex];
                        const recordDate = recordData_${projectId}_${roundId}_${cropId}[recordIndex].date;

                        let imageHTML = '<h3 style="margin-bottom: 20px; color: #333;">üì∑ ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ' + recordDate + '</h3>';
                        imageHTML += '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">';

                        images.forEach(function(img) {
                            imageHTML += '<div style="border-radius: 8px; overflow: hidden; border: 2px solid #e0e0e0;">';
                            imageHTML += '<img src="' + img + '" style="width: 100%; height: 200px; object-fit: cover; cursor: pointer;" onclick="window.open(\'' + img + '\', \'_blank\')">';
                            imageHTML += '</div>';
                        });

                        imageHTML += '</div>';
                        imageHTML += '<p style="margin-top: 15px; color: #666; font-size: 0.9rem;">üí° ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏£‡∏π‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏ï‡πá‡∏°</p>';

                        content.innerHTML = imageHTML;
                        modal.style.display = 'block';
                        document.body.style.overflow = 'hidden';
                    };

                    window.closeImageModal = function() {
                        document.getElementById('imageModal').style.display = 'none';
                        document.body.style.overflow = 'auto';
                    };

                    // Close modal when clicking outside
                    document.getElementById('imageModal')?.addEventListener('click', function(e) {
                        if (e.target === this) {
                            closeImageModal();
                        }
                    });
                <\/script>
            `;
        }

        function backToProject() {
            if (currentProjectId) {
                viewProject(currentProjectId);
            }
        }

        function backToRound() {
            if (currentProjectId && currentRoundId) {
                viewRound(currentProjectId, currentRoundId);
            }
        }

        function updateDataProjectOptions() {
            const select = document.getElementById('dataProject');
            select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</option>' +
                projects.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
        }

        function updateDataRounds() {
            const projectId = parseInt(document.getElementById('dataProject').value);
            const select = document.getElementById('dataRound');

            if (!projectId) {
                select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏ö</option>';
                return;
            }

            const project = projects.find(p => p.id === projectId);
            select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏ö</option>' +
                project.rounds.map(r => `<option value="${r.id}">${r.name} - ${r.plants.join(', ')}</option>`).join('');
        }

        function previewDataImages(event) {
            const preview = document.getElementById('dataImagePreview');
            preview.innerHTML = '';

            const files = event.target.files;
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const reader = new FileReader();

                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    preview.appendChild(img);
                }

                reader.readAsDataURL(file);
            }
        }

        document.getElementById('dataForm').addEventListener('submit', function(e) {
            e.preventDefault();
            alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤ AI');
            this.reset();
            document.getElementById('dataImagePreview').innerHTML = '';
        });

        // Settings dropdown functions
        function toggleSettings() {
            const menu = document.getElementById('settingsMenu');
            menu.classList.toggle('show');
        }

        function showTemplates() {
            alert('üìù Templates Management\n\n‡πÅ‡∏™‡∏î‡∏á:\n- Template: ‡∏ú‡∏±‡∏Å‡∏Å‡∏≤‡∏î‡∏´‡∏≠‡∏° (‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô 3 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á)\n- Template: ‡∏ú‡∏±‡∏Å‡πÉ‡∏ö (‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô 8 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á)\n- + ‡∏™‡∏£‡πâ‡∏≤‡∏á Template ‡πÉ‡∏´‡∏°‡πà\n\n‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Templates ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö');
            document.getElementById('settingsMenu').classList.remove('show');
        }

        // Close dropdown when clicking outside (removed - no settings dropdown)

        // Sensor Charts
        function initSensorCharts() {
            const days = ['6 ‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô', '5 ‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô', '4 ‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô', '3 ‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô', '2 ‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô', '‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô', '‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ'];

            // pH Chart
            new Chart(document.getElementById('phChart'), {
                type: 'line',
                data: {
                    labels: days,
                    datasets: [{
                        label: 'pH',
                        data: [6.1, 6.0, 6.2, 6.3, 6.1, 6.2, 6.2],
                        borderColor: '#43cea2',
                        backgroundColor: 'rgba(67, 206, 162, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } }
                }
            });

            // EC Chart
            new Chart(document.getElementById('ecChart'), {
                type: 'line',
                data: {
                    labels: days,
                    datasets: [{
                        label: 'EC (mS/cm)',
                        data: [2.0, 2.1, 2.2, 2.1, 2.0, 2.1, 2.1],
                        borderColor: '#185a9d',
                        backgroundColor: 'rgba(24, 90, 157, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } }
                }
            });

            // Temperature Chart
            new Chart(document.getElementById('tempChart'), {
                type: 'line',
                data: {
                    labels: days,
                    datasets: [{
                        label: '‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (¬∞C)',
                        data: [25.5, 26.0, 26.5, 27.0, 26.5, 26.0, 26.5],
                        borderColor: '#ff6b6b',
                        backgroundColor: 'rgba(255, 107, 107, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } }
                }
            });

            // PPFD Chart
            new Chart(document.getElementById('ppfdChart'), {
                type: 'line',
                data: {
                    labels: days,
                    datasets: [{
                        label: 'PPFD (¬µmol/m¬≤/s)',
                        data: [245, 250, 248, 252, 250, 248, 250],
                        borderColor: '#ffd93d',
                        backgroundColor: 'rgba(255, 217, 61, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } }
                }
            });
        }

        // Greenhouse Selection Functions
        let selectedGreenhouse = null;

        const greenhouseData = {
            no1: {
                name: 'üè† No.1 - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏Å',
                sensors: {
                    ph: 6.2,
                    ec: 2.1,
                    temp: 26.5,
                    ppfd: 250
                },
                history: {
                    ph: [6.1, 6.0, 6.2, 6.3, 6.1, 6.2, 6.2],
                    ec: [2.0, 2.1, 2.2, 2.1, 2.0, 2.1, 2.1],
                    temp: [25.5, 26.0, 26.5, 27.0, 26.5, 26.0, 26.5],
                    ppfd: [245, 250, 248, 252, 250, 248, 250]
                }
            },
            laba: {
                name: 'üî¨ Lab A - Lab ‡∏ó‡∏î‡∏•‡∏≠‡∏á',
                sensors: {
                    ph: 6.5,
                    ec: 1.8,
                    temp: 24.2,
                    ppfd: 280
                },
                history: {
                    ph: [6.4, 6.5, 6.6, 6.5, 6.4, 6.5, 6.5],
                    ec: [1.7, 1.8, 1.9, 1.8, 1.7, 1.8, 1.8],
                    temp: [23.8, 24.0, 24.2, 24.5, 24.3, 24.1, 24.2],
                    ppfd: [275, 280, 278, 282, 280, 278, 280]
                }
            },
            blue: {
                name: 'üîµ Blue Room - ‡∏´‡πâ‡∏≠‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥',
                sensors: {
                    ph: 5.8,
                    ec: 2.3,
                    temp: 22.0,
                    ppfd: 320
                },
                history: {
                    ph: [5.7, 5.8, 5.9, 5.8, 5.7, 5.8, 5.8],
                    ec: [2.2, 2.3, 2.4, 2.3, 2.2, 2.3, 2.3],
                    temp: [21.5, 22.0, 22.2, 22.5, 22.3, 22.1, 22.0],
                    ppfd: [315, 320, 318, 322, 320, 318, 320]
                }
            }
        };

        function selectGreenhouse(id) {
            selectedGreenhouse = id;
            const data = greenhouseData[id];

            // Hide selection cards
            document.getElementById('greenhouseCards').parentElement.style.display = 'none';

            // Show data section
            document.getElementById('greenhouseData').style.display = 'block';

            // Update title
            document.getElementById('selectedGreenhouseName').textContent = `üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• - ${data.name}`;

            // Update real-time stats
            document.querySelectorAll('.stat-value')[0].textContent = data.sensors.ph;
            document.querySelectorAll('.stat-value')[1].textContent = data.sensors.ec;
            document.querySelectorAll('.stat-value')[2].textContent = data.sensors.temp;
            document.querySelectorAll('.stat-value')[3].textContent = data.sensors.ppfd;

            // Update charts
            updateCharts(data.history);
        }

        function clearSelection() {
            selectedGreenhouse = null;

            // Show selection cards
            document.getElementById('greenhouseCards').parentElement.style.display = 'block';

            // Hide data section
            document.getElementById('greenhouseData').style.display = 'none';
        }

        function updateCharts(history) {
            const days = ['6 ‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô', '5 ‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô', '4 ‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô', '3 ‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô', '2 ‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô', '‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô', '‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ'];

            // Destroy existing charts
            Chart.getChart('phChart')?.destroy();
            Chart.getChart('ecChart')?.destroy();
            Chart.getChart('tempChart')?.destroy();
            Chart.getChart('ppfdChart')?.destroy();

            // pH Chart
            new Chart(document.getElementById('phChart'), {
                type: 'line',
                data: {
                    labels: days,
                    datasets: [{
                        label: 'pH',
                        data: history.ph,
                        borderColor: '#43cea2',
                        backgroundColor: 'rgba(67, 206, 162, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } }
                }
            });

            // EC Chart
            new Chart(document.getElementById('ecChart'), {
                type: 'line',
                data: {
                    labels: days,
                    datasets: [{
                        label: 'EC (mS/cm)',
                        data: history.ec,
                        borderColor: '#185a9d',
                        backgroundColor: 'rgba(24, 90, 157, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } }
                }
            });

            // Temperature Chart
            new Chart(document.getElementById('tempChart'), {
                type: 'line',
                data: {
                    labels: days,
                    datasets: [{
                        label: '‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (¬∞C)',
                        data: history.temp,
                        borderColor: '#ff6b6b',
                        backgroundColor: 'rgba(255, 107, 107, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } }
                }
            });

            // PPFD Chart
            new Chart(document.getElementById('ppfdChart'), {
                type: 'line',
                data: {
                    labels: days,
                    datasets: [{
                        label: 'PPFD (¬µmol/m¬≤/s)',
                        data: history.ppfd,
                        borderColor: '#ffd93d',
                        backgroundColor: 'rgba(255, 217, 61, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } }
                }
            });
        }
    </script>
</body>
</html>
